!function(n,c){"use strict";function l(b,a,g){var d=g.baseHref(),k=b[0];return function(b,e,f){var g,h;f=f||{},h=f.expires,g=c.isDefined(f.path)?f.path:d,c.isUndefined(e)&&(h="Thu, 01 Jan 1970 00:00:00 GMT",e=""),c.isString(h)&&(h=new Date(h)),e=encodeURIComponent(b)+"="+encodeURIComponent(e),e=e+(g?";path="+g:"")+(f.domain?";domain="+f.domain:""),e+=h?";expires="+h.toUTCString():"",e+=f.secure?";secure":"",f=e.length+1,4096<f&&a.warn("Cookie '"+b+"' possibly not set or overflowed because it was too large ("+f+" > 4096 bytes)!"),k.cookie=e}}c.module("ngCookies",["ng"]).provider("$cookies",[function(){var b=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function(a,g){return{get:function(d){return a()[d]},getObject:function(d){return(d=this.get(d))?c.fromJson(d):d},getAll:function(){return a()},put:function(d,a,m){g(d,a,m?c.extend({},b,m):b)},putObject:function(d,b,a){this.put(d,c.toJson(b),a)},remove:function(a,k){g(a,void 0,k?c.extend({},b,k):b)}}}]}]),c.module("ngCookies").factory("$cookieStore",["$cookies",function(b){return{get:function(a){return b.getObject(a)},put:function(a,c){b.putObject(a,c)},remove:function(a){b.remove(a)}}}]),l.$inject=["$document","$log","$browser"],c.module("ngCookies").provider("$$cookieWriter",function(){this.$get=l})}(window,window.angular);var app=angular.module("TestFrontend",["ngMaterial","ngCookies"]);app.controller("MainCtrl",function($scope,$mdSidenav,$cookies,Account,Project,Task){function getAccountData(){Account.fetchAccount($cookies.get("userSessionKey"),function(data){$scope.account=data})}function getProjects(){Project.fetchProjects($cookies.get("userSessionKey"),function(data){$scope.projects=data})}function getTasks(){0!=$scope.project.id?($scope.content="views/tasks.tpl.html",Task.fetchTasks($cookies.get("userSessionKey"),$scope.project.id,$scope.sizeTask,0,$scope.search,function(data){$scope.tasks=data.tasks,$scope.sizeTask>=data.total_count?$scope.isAllTasks=!0:$scope.isAllTasks=!1,$scope.countTask=data.total_count})):$scope.content="views/select_project.tpl.html"}function buildToggler(componentId){return function(){$mdSidenav(componentId).toggle()}}$scope.loading=!0,$scope.stepTask=3,$scope.countTask=0,$scope.project={id:0},"string"!=typeof $cookies.get("userSessionKey")?($scope.loading=!0,Account.createNewUser(function(data){$cookies.put("userSessionKey",data.session),getAccountData(),getProjects(),$scope.loading=!1})):($scope.loading=!0,Account.checkSession($cookies.get("userSessionKey"),function(){$scope.loading=!1,getAccountData(),getProjects(),$scope.loading=!1})),$scope.$watch("project.id",function(){$scope.sizeTask=13,$scope.search=null,getTasks()}),$scope.$watch("tasks",function(){0==$scope.project.id||0!=$scope.countTask||$scope.search?0==$scope.countTask&&$scope.search&&($scope.content="views/tasks_not.tpl.html"):$scope.content="views/tasks_done.tpl.html"}),$scope.$watch("search",function(){""==$scope.search&&getTasks()}),$scope.searchTasks=function(){getTasks()},$scope.addProjectBar=function(){delete $scope.newProject,$scope.toggleRight(),$scope.rightBar="views/project_add.tpl.html"},$scope.showTaskBar=function(taskId){Task.fetchTask($cookies.get("userSessionKey"),taskId,function(data){$scope.task=data,$scope.toggleRight(),$scope.rightBar="views/task.tpl.html"})},$scope.editProjectBar=function(){$scope.toggleRight(),$scope.project.newTitle=$scope.project.title,$scope.rightBar="views/project_edit.tpl.html"},$scope.addTaskBar=function(){delete $scope.newTask,$scope.toggleRight(),$scope.rightBar="views/task_add.tpl.html"},$scope.editTaskBar=function(){$scope.rightBar="views/task_edit.tpl.html"},$scope.addProject=function(){Project.createProject($cookies.get("userSessionKey"),$scope.newProject.title,function(){getProjects(),$scope.toggleRight()})},$scope.deleteProject=function(){Project.deleteProject($cookies.get("userSessionKey"),$scope.project.id,function(){getProjects(),delete $scope.project,$scope.content="views/select_project.tpl.html"})},$scope.editProject=function(){Project.updateProject($cookies.get("userSessionKey"),$scope.project.id,$scope.project.newTitle,function(){getProjects(),$scope.toggleRight(),$scope.project.title=$scope.project.newTitle})},$scope.addTask=function(){Task.createTask($cookies.get("userSessionKey"),$scope.project.id,$scope.newTask.title,$scope.newTask.description,function(){getProjects(),getTasks(),$scope.toggleRight()})},$scope.editTask=function(){Task.updateTask($cookies.get("userSessionKey"),$scope.task.id,$scope.task.title,$scope.task.description,function(){getTasks(),$scope.rightBar="views/task.tpl.html"})},$scope.deleteTask=function(){Task.deleteTask($cookies.get("userSessionKey"),$scope.task.id,function(){getProjects(),getTasks(),$scope.toggleRight()})},$scope.compliteTask=function(id){Task.compliteTask($cookies.get("userSessionKey"),id,function(){getProjects(),getTasks()})},$scope.loadMoreTasks=function(){$scope.isAllTasks||($scope.sizeTask=$scope.sizeTask+$scope.stepTask,$scope.sizeTask>$scope.countTask&&($scope.sizeTask=$scope.countTask),getTasks())},$scope.openMenu=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},$scope.toggleRight=buildToggler("right")}),app.service("Account",function($http,$log){this.createNewUser=function(callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/signup"}).then(function(response){callback(response.data)},function(){$log.error("API createNewUser error")})},this.checkSession=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/session",params:{session:session}}).then(function(response){callback(response)},function(){$log.error("API checkSession error")})},this.fetchAccount=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/account",params:{session:session}}).then(function(response){callback(response.data.Account)},function(){$log.error("API fetchAccount error")})}}),app.service("Project",function($http,$log){this.fetchProjects=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects",params:{session:session}}).then(function(response){callback(response.data.projects)},function(){$log.error("API fetchProjects error")})},this.fetchProject=function(session,project_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:project_id}}).then(function(response){callback(response)},function(){$log.error("API fetchProject error")})},this.createProject=function(session,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API createProject error")})},this.updateProject=function(session,id,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{id:id,title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API updateProject error")})},this.deleteProject=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:id}}).then(function(response){callback(response.data.Account)},function(){$log.error("API deleteProject error")})}}),app.service("Task",function($http,$log,$filter){this.fetchTasks=function(session,project_id,paging_size,paging_offset,condition_keywords,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks",params:{session:session,project_id:project_id,paging_size:paging_size,paging_offset:paging_offset,condition_keywords:condition_keywords}}).then(function(response){var date,rObj={},tomorrow=new Date;tomorrow.setDate(tomorrow.getDate()-1),response.data.tasks.forEach(function(item){var taskDate=new Date(item.Task.created_at);item.Task.date=$filter("date")(taskDate,"EEEE")+" ("+$filter("date")(taskDate,"dd.MM.yyyy")+")",$filter("date")(new Date,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")?item.Task.date="Today":$filter("date")(tomorrow,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")&&(item.Task.date="Yesterday"),null!=item.Task.title&&(item.Task.date==date?rObj[date].push(item.Task):(date=item.Task.date,rObj[date]=[item.Task]))}),callback({tasks:rObj,total_count:response.data.total_count})},function(){$log.error("API fetchTasks error")})},this.fetchTask=function(session,task_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:task_id}}).then(function(response){callback(response.data.Task)},function(){$log.error("API fetchProject error")})},this.createTask=function(session,project_id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Project:{id:project_id},Task:{title:title,description:description}}}).then(function(response){callback(response.data.Task)},function(){$log.error("API createTask error")})},this.updateTask=function(session,id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id,title:title,description:description}}}).then(function(response){callback(response.data)},function(){$log.error("API updateTask error")})},this.deleteTask=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:id}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})},this.compliteTask=function(session,id,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id}}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})}}),app.directive("projectsList",function(){return{restrict:"AE",templateUrl:"views/projects.tpl.html"}}),app.directive("whenScrolled",function(){return function(scope,elm,attr){var raw=elm[0];elm.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight&&scope.$apply(attr.whenScrolled)})}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibiIsImMiLCJsIiwiYiIsImEiLCJnIiwiZCIsImJhc2VIcmVmIiwiayIsImUiLCJmIiwiaCIsImV4cGlyZXMiLCJpc0RlZmluZWQiLCJwYXRoIiwiaXNVbmRlZmluZWQiLCJpc1N0cmluZyIsIkRhdGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJkb21haW4iLCJ0b1VUQ1N0cmluZyIsInNlY3VyZSIsImxlbmd0aCIsIndhcm4iLCJjb29raWUiLCJtb2R1bGUiLCJwcm92aWRlciIsInRoaXMiLCJkZWZhdWx0cyIsIiRnZXQiLCJnZXQiLCJnZXRPYmplY3QiLCJmcm9tSnNvbiIsImdldEFsbCIsInB1dCIsIm0iLCJleHRlbmQiLCJwdXRPYmplY3QiLCJ0b0pzb24iLCJyZW1vdmUiLCJmYWN0b3J5IiwiJGluamVjdCIsIndpbmRvdyIsImFuZ3VsYXIiLCJhcHAiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJG1kU2lkZW5hdiIsIiRjb29raWVzIiwiQWNjb3VudCIsIlByb2plY3QiLCJUYXNrIiwiZ2V0QWNjb3VudERhdGEiLCJmZXRjaEFjY291bnQiLCJkYXRhIiwiYWNjb3VudCIsImdldFByb2plY3RzIiwiZmV0Y2hQcm9qZWN0cyIsInByb2plY3RzIiwiZ2V0VGFza3MiLCJwcm9qZWN0IiwiaWQiLCJjb250ZW50IiwiZmV0Y2hUYXNrcyIsInNpemVUYXNrIiwic2VhcmNoIiwidGFza3MiLCJ0b3RhbF9jb3VudCIsImlzQWxsVGFza3MiLCJjb3VudFRhc2siLCJidWlsZFRvZ2dsZXIiLCJjb21wb25lbnRJZCIsInRvZ2dsZSIsImxvYWRpbmciLCJzdGVwVGFzayIsImNyZWF0ZU5ld1VzZXIiLCJzZXNzaW9uIiwiY2hlY2tTZXNzaW9uIiwiJHdhdGNoIiwic2VhcmNoVGFza3MiLCJhZGRQcm9qZWN0QmFyIiwibmV3UHJvamVjdCIsInRvZ2dsZVJpZ2h0IiwicmlnaHRCYXIiLCJzaG93VGFza0JhciIsInRhc2tJZCIsImZldGNoVGFzayIsInRhc2siLCJlZGl0UHJvamVjdEJhciIsIm5ld1RpdGxlIiwidGl0bGUiLCJhZGRUYXNrQmFyIiwibmV3VGFzayIsImVkaXRUYXNrQmFyIiwiYWRkUHJvamVjdCIsImNyZWF0ZVByb2plY3QiLCJkZWxldGVQcm9qZWN0IiwiZWRpdFByb2plY3QiLCJ1cGRhdGVQcm9qZWN0IiwiYWRkVGFzayIsImNyZWF0ZVRhc2siLCJkZXNjcmlwdGlvbiIsImVkaXRUYXNrIiwidXBkYXRlVGFzayIsImRlbGV0ZVRhc2siLCJjb21wbGl0ZVRhc2siLCJsb2FkTW9yZVRhc2tzIiwib3Blbk1lbnUiLCIkbWRPcGVuTWVudSIsImV2Iiwib3JpZ2luYXRvckV2Iiwic2VydmljZSIsIiRodHRwIiwiJGxvZyIsImNhbGxiYWNrIiwibWV0aG9kIiwidXJsIiwidGhlbiIsInJlc3BvbnNlIiwiZXJyb3IiLCJwYXJhbXMiLCJmZXRjaFByb2plY3QiLCJwcm9qZWN0X2lkIiwiJGZpbHRlciIsInBhZ2luZ19zaXplIiwicGFnaW5nX29mZnNldCIsImNvbmRpdGlvbl9rZXl3b3JkcyIsImRhdGUiLCJyT2JqIiwidG9tb3Jyb3ciLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImZvckVhY2giLCJpdGVtIiwidGFza0RhdGUiLCJjcmVhdGVkX2F0IiwicHVzaCIsInRhc2tfaWQiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInRlbXBsYXRlVXJsIiwic2NvcGUiLCJlbG0iLCJhdHRyIiwicmF3IiwiYmluZCIsInNjcm9sbFRvcCIsIm9mZnNldEhlaWdodCIsInNjcm9sbEhlaWdodCIsIiRhcHBseSIsIndoZW5TY3JvbGxlZCJdLCJtYXBwaW5ncyI6IkNBU0EsU0FBVUEsRUFBRUMsR0FBRyxZQUFhLFNBQVNDLEdBQUVDLEVBQUVDLEVBQUVDLEdBQUcsR0FBSUMsR0FBRUQsRUFBRUUsV0FBV0MsRUFBRUwsRUFBRSxFQUFHLE9BQU8sVUFBU0EsRUFBRU0sRUFBRUMsR0FBRyxHQUFJTCxHQUFFTSxDQUFFRCxHQUFFQSxNQUFNQyxFQUFFRCxF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S0FBSyxTQUFVLFdBQ1hELElBQUlFLFVBQVlGLElBQUlHLGNBQWdCSCxJQUFJSSxjQUN4Q1AsTUFBTVEsT0FBT04sS0FBS08iLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBKZXhpbSBvbiAxOS4xMC4xNi5cbiAqL1xuXG4vKlxuIEFuZ3VsYXJKUyB2MS41LjhcbiAoYykgMjAxMC0yMDE2IEdvb2dsZSwgSW5jLiBodHRwOi8vYW5ndWxhcmpzLm9yZ1xuIExpY2Vuc2U6IE1JVFxuKi9cbihmdW5jdGlvbihuLGMpeyd1c2Ugc3RyaWN0JztmdW5jdGlvbiBsKGIsYSxnKXt2YXIgZD1nLmJhc2VIcmVmKCksaz1iWzBdO3JldHVybiBmdW5jdGlvbihiLGUsZil7dmFyIGcsaDtmPWZ8fHt9O2g9Zi5leHBpcmVzO2c9Yy5pc0RlZmluZWQoZi5wYXRoKT9mLnBhdGg6ZDtjLmlzVW5kZWZpbmVkKGUpJiYoaD1cIlRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgR01UXCIsZT1cIlwiKTtjLmlzU3RyaW5nKGgpJiYoaD1uZXcgRGF0ZShoKSk7ZT1lbmNvZGVVUklDb21wb25lbnQoYikrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGUpO2U9ZSsoZz9cIjtwYXRoPVwiK2c6XCJcIikrKGYuZG9tYWluP1wiO2RvbWFpbj1cIitmLmRvbWFpbjpcIlwiKTtlKz1oP1wiO2V4cGlyZXM9XCIraC50b1VUQ1N0cmluZygpOlwiXCI7ZSs9Zi5zZWN1cmU/XCI7c2VjdXJlXCI6XCJcIjtmPWUubGVuZ3RoKzE7NDA5NjxmJiZhLndhcm4oXCJDb29raWUgJ1wiK2IrXCInIHBvc3NpYmx5IG5vdCBzZXQgb3Igb3ZlcmZsb3dlZCBiZWNhdXNlIGl0IHdhcyB0b28gbGFyZ2UgKFwiK1xuZitcIiA+IDQwOTYgYnl0ZXMpIVwiKTtrLmNvb2tpZT1lfX1jLm1vZHVsZShcIm5nQ29va2llc1wiLFtcIm5nXCJdKS5wcm92aWRlcihcIiRjb29raWVzXCIsW2Z1bmN0aW9uKCl7dmFyIGI9dGhpcy5kZWZhdWx0cz17fTt0aGlzLiRnZXQ9W1wiJCRjb29raWVSZWFkZXJcIixcIiQkY29va2llV3JpdGVyXCIsZnVuY3Rpb24oYSxnKXtyZXR1cm57Z2V0OmZ1bmN0aW9uKGQpe3JldHVybiBhKClbZF19LGdldE9iamVjdDpmdW5jdGlvbihkKXtyZXR1cm4oZD10aGlzLmdldChkKSk/Yy5mcm9tSnNvbihkKTpkfSxnZXRBbGw6ZnVuY3Rpb24oKXtyZXR1cm4gYSgpfSxwdXQ6ZnVuY3Rpb24oZCxhLG0pe2coZCxhLG0/Yy5leHRlbmQoe30sYixtKTpiKX0scHV0T2JqZWN0OmZ1bmN0aW9uKGQsYixhKXt0aGlzLnB1dChkLGMudG9Kc29uKGIpLGEpfSxyZW1vdmU6ZnVuY3Rpb24oYSxrKXtnKGEsdm9pZCAwLGs/Yy5leHRlbmQoe30sYixrKTpiKX19fV19XSk7Yy5tb2R1bGUoXCJuZ0Nvb2tpZXNcIikuZmFjdG9yeShcIiRjb29raWVTdG9yZVwiLFxuW1wiJGNvb2tpZXNcIixmdW5jdGlvbihiKXtyZXR1cm57Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBiLmdldE9iamVjdChhKX0scHV0OmZ1bmN0aW9uKGEsYyl7Yi5wdXRPYmplY3QoYSxjKX0scmVtb3ZlOmZ1bmN0aW9uKGEpe2IucmVtb3ZlKGEpfX19XSk7bC4kaW5qZWN0PVtcIiRkb2N1bWVudFwiLFwiJGxvZ1wiLFwiJGJyb3dzZXJcIl07Yy5tb2R1bGUoXCJuZ0Nvb2tpZXNcIikucHJvdmlkZXIoXCIkJGNvb2tpZVdyaXRlclwiLGZ1bmN0aW9uKCl7dGhpcy4kZ2V0PWx9KX0pKHdpbmRvdyx3aW5kb3cuYW5ndWxhcik7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hbmd1bGFyLWNvb2tpZXMubWluLmpzLm1hcFxuXG4vKipcbiAqIENyZWF0ZWQgYnkgSmV4aW0gb24gMTkuMTAuMTYuXG4gKi9cblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdUZXN0RnJvbnRlbmQnLCBbJ25nTWF0ZXJpYWwnLCAnbmdDb29raWVzJ10pO1xuXG5hcHAuY29udHJvbGxlcignTWFpbkN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbWRTaWRlbmF2LCAkY29va2llcywgQWNjb3VudCwgUHJvamVjdCwgVGFzayl7XG5cbiAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgJHNjb3BlLnN0ZXBUYXNrID0gMztcbiAgICAkc2NvcGUuY291bnRUYXNrID0gMDtcbiAgICAkc2NvcGUucHJvamVjdCA9IHsgaWQ6IDAgfTtcblxuICAgIGlmKHR5cGVvZiAkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JykgIT0gJ3N0cmluZycpe1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIEFjY291bnQuY3JlYXRlTmV3VXNlcihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgndXNlclNlc3Npb25LZXknLCBkYXRhLnNlc3Npb24pO1xuICAgICAgICAgICAgZ2V0QWNjb3VudERhdGEoKTtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIEFjY291bnQuY2hlY2tTZXNzaW9uKCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgZ2V0QWNjb3VudERhdGEoKTtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAkc2NvcGUuJHdhdGNoKCdwcm9qZWN0LmlkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5zaXplVGFzayA9IDEzO1xuICAgICAgICAkc2NvcGUuc2VhcmNoID0gbnVsbDtcbiAgICAgICAgZ2V0VGFza3MoKTtcbiAgICB9KTtcblxuICAgICRzY29wZS4kd2F0Y2goJ3Rhc2tzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZigkc2NvcGUucHJvamVjdC5pZCAhPSAwICYmICRzY29wZS5jb3VudFRhc2sgPT0gMCAmJiAhJHNjb3BlLnNlYXJjaCl7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy90YXNrc19kb25lLnRwbC5odG1sJztcbiAgICAgICAgfSBlbHNlIGlmKCRzY29wZS5jb3VudFRhc2sgPT0gMCAmJiAkc2NvcGUuc2VhcmNoKSB7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy90YXNrc19ub3QudHBsLmh0bWwnO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJHdhdGNoKCdzZWFyY2gnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoJHNjb3BlLnNlYXJjaCA9PSAnJylcbiAgICAgICAgICAgIGdldFRhc2tzKCk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuc2VhcmNoVGFza3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgZ2V0VGFza3MoKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmFkZFByb2plY3RCYXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgZGVsZXRlICRzY29wZS5uZXdQcm9qZWN0O1xuICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgJHNjb3BlLnJpZ2h0QmFyID0gJ3ZpZXdzL3Byb2plY3RfYWRkLnRwbC5odG1sJztcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNob3dUYXNrQmFyID0gZnVuY3Rpb24odGFza0lkKSB7XG4gICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLmZldGNoVGFzaygkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksIHRhc2tJZCwgZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAkc2NvcGUudGFzayA9IGRhdGE7XG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy90YXNrLnRwbC5odG1sJztcbiAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5lZGl0UHJvamVjdEJhciAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICRzY29wZS5wcm9qZWN0Lm5ld1RpdGxlID0gJHNjb3BlLnByb2plY3QudGl0bGU7XG4gICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy9wcm9qZWN0X2VkaXQudHBsLmh0bWwnO1xuICAgIH07XG5cblxuICAgICRzY29wZS5hZGRUYXNrQmFyICA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkZWxldGUgJHNjb3BlLm5ld1Rhc2s7XG4gICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvdGFza19hZGQudHBsLmh0bWwnO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZWRpdFRhc2tCYXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnJpZ2h0QmFyID0gJ3ZpZXdzL3Rhc2tfZWRpdC50cGwuaHRtbCc7XG4gICAgfTtcblxuICAgICRzY29wZS5hZGRQcm9qZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBQcm9qZWN0LmNyZWF0ZVByb2plY3QoJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCAkc2NvcGUubmV3UHJvamVjdC50aXRsZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZGVsZXRlUHJvamVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgUHJvamVjdC5kZWxldGVQcm9qZWN0KCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgJHNjb3BlLnByb2plY3QuaWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGRlbGV0ZSAkc2NvcGUucHJvamVjdDtcbiAgICAgICAgICAgICRzY29wZS5jb250ZW50ID0gJ3ZpZXdzL3NlbGVjdF9wcm9qZWN0LnRwbC5odG1sJztcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5lZGl0UHJvamVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgUHJvamVjdC51cGRhdGVQcm9qZWN0KCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgJHNjb3BlLnByb2plY3QuaWQsICRzY29wZS5wcm9qZWN0Lm5ld1RpdGxlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgICRzY29wZS5wcm9qZWN0LnRpdGxlID0gJHNjb3BlLnByb2plY3QubmV3VGl0bGU7XG4gICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cblxuICAgICRzY29wZS5hZGRUYXNrICA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgVGFzay5jcmVhdGVUYXNrKFxuICAgICAgICAgICAgJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLFxuICAgICAgICAgICAgJHNjb3BlLnByb2plY3QuaWQsXG4gICAgICAgICAgICAkc2NvcGUubmV3VGFzay50aXRsZSxcbiAgICAgICAgICAgICRzY29wZS5uZXdUYXNrLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgICAgICBnZXRUYXNrcygpO1xuICAgICAgICAgICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmVkaXRUYXNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLnVwZGF0ZVRhc2soXG4gICAgICAgICAgICAkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksXG4gICAgICAgICAgICAkc2NvcGUudGFzay5pZCxcbiAgICAgICAgICAgICRzY29wZS50YXNrLnRpdGxlLFxuICAgICAgICAgICAgJHNjb3BlLnRhc2suZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBnZXRUYXNrcygpO1xuICAgICAgICAgICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy90YXNrLnRwbC5odG1sJztcbiAgICAgICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfTtcblxuICAgICRzY29wZS5kZWxldGVUYXNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLmRlbGV0ZVRhc2soJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCAkc2NvcGUudGFzay5pZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgIGdldFRhc2tzKCk7XG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5jb21wbGl0ZVRhc2sgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgVGFzay5jb21wbGl0ZVRhc2soJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCBpZCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5sb2FkTW9yZVRhc2tzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZighJHNjb3BlLmlzQWxsVGFza3Mpe1xuICAgICAgICAgICAgJHNjb3BlLnNpemVUYXNrID0gJHNjb3BlLnNpemVUYXNrICsgJHNjb3BlLnN0ZXBUYXNrO1xuICAgICAgICAgICAgaWYoJHNjb3BlLnNpemVUYXNrID4gJHNjb3BlLmNvdW50VGFzaylcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZVRhc2sgPSAkc2NvcGUuY291bnRUYXNrO1xuICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUub3Blbk1lbnUgPSBmdW5jdGlvbigkbWRPcGVuTWVudSwgZXYpIHtcbiAgICAgICAgb3JpZ2luYXRvckV2ID0gZXY7XG4gICAgICAgICRtZE9wZW5NZW51KGV2KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnRvZ2dsZVJpZ2h0ID0gYnVpbGRUb2dnbGVyKCdyaWdodCcpO1xuXG4gICAgZnVuY3Rpb24gZ2V0QWNjb3VudERhdGEoKSB7XG4gICAgICAgIEFjY291bnQuZmV0Y2hBY2NvdW50KCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLmFjY291bnQgPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRQcm9qZWN0cygpIHtcbiAgICAgICAgUHJvamVjdC5mZXRjaFByb2plY3RzKCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLnByb2plY3RzID0gZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0VGFza3MoKSB7XG4gICAgICAgIGlmKCRzY29wZS5wcm9qZWN0LmlkICE9IDApe1xuICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy90YXNrcy50cGwuaHRtbCc7XG4gICAgICAgICAgICBUYXNrLmZldGNoVGFza3MoXG4gICAgICAgICAgICAgICAgJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLFxuICAgICAgICAgICAgICAgICRzY29wZS5wcm9qZWN0LmlkLFxuICAgICAgICAgICAgICAgICRzY29wZS5zaXplVGFzayxcbiAgICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICAgICRzY29wZS5zZWFyY2gsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGFza3MgPSBkYXRhLnRhc2tzO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZVRhc2sgPj0gZGF0YS50b3RhbF9jb3VudCA/ICRzY29wZS5pc0FsbFRhc2tzID0gdHJ1ZSA6ICRzY29wZS5pc0FsbFRhc2tzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudFRhc2sgPSBkYXRhLnRvdGFsX2NvdW50O1xuICAgICAgICAgICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRzY29wZS5jb250ZW50ID0gJ3ZpZXdzL3NlbGVjdF9wcm9qZWN0LnRwbC5odG1sJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJ1aWxkVG9nZ2xlcihjb21wb25lbnRJZCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbWRTaWRlbmF2KGNvbXBvbmVudElkKS50b2dnbGUoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuYXBwLnNlcnZpY2UoJ0FjY291bnQnLCBmdW5jdGlvbigkaHR0cCwgJGxvZykge1xuXG4gICAgdGhpcy5jcmVhdGVOZXdVc2VyID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9zaWdudXAnXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBjcmVhdGVOZXdVc2VyIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB0aGlzLmNoZWNrU2Vzc2lvbiA9IGZ1bmN0aW9uIChzZXNzaW9uICxjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vc2Vzc2lvbicsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9ufSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBjaGVja1Nlc3Npb24gZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHRoaXMuZmV0Y2hBY2NvdW50ID0gZnVuY3Rpb24oc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL2FjY291bnQnLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbn0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLkFjY291bnQpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGZldGNoQWNjb3VudCBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcbmFwcC5zZXJ2aWNlKCdQcm9qZWN0JywgZnVuY3Rpb24oJGh0dHAsICRsb2cpIHtcblxuICAgIHRoaXMuZmV0Y2hQcm9qZWN0cyA9IGZ1bmN0aW9uKHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cycsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9ufSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEucHJvamVjdHMpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGZldGNoUHJvamVjdHMgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuZmV0Y2hQcm9qZWN0ID0gZnVuY3Rpb24gKHNlc3Npb24gLCBwcm9qZWN0X2lkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vcHJvamVjdHMvcHJvamVjdCcsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9uLCBwcm9qZWN0X2lkOiBwcm9qZWN0X2lkfSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBmZXRjaFByb2plY3QgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuY3JlYXRlUHJvamVjdCA9IGZ1bmN0aW9uKHNlc3Npb24sIHRpdGxlLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Byb2plY3RzL3Byb2plY3QnLFxuICAgICAgICAgICAgZGF0YToge3Nlc3Npb246IHNlc3Npb24sIFByb2plY3Q6IHsgdGl0bGU6IHRpdGxlIH19LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5BY2NvdW50KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBjcmVhdGVQcm9qZWN0IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLnVwZGF0ZVByb2plY3QgPSBmdW5jdGlvbihzZXNzaW9uLCBpZCwgdGl0bGUsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vcHJvamVjdHMvcHJvamVjdCcsXG4gICAgICAgICAgICBkYXRhOiB7c2Vzc2lvbjogc2Vzc2lvbiwgUHJvamVjdDogeyBpZDogaWQsIHRpdGxlOiB0aXRsZSB9fSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuQWNjb3VudCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgdXBkYXRlUHJvamVjdCBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZWxldGVQcm9qZWN0ID0gZnVuY3Rpb24oc2Vzc2lvbiwgaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cy9wcm9qZWN0JyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb24sIHByb2plY3RfaWQ6IGlkfSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuQWNjb3VudCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZGVsZXRlUHJvamVjdCBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcbmFwcC5zZXJ2aWNlKCdUYXNrJywgZnVuY3Rpb24oJGh0dHAsICRsb2csICRmaWx0ZXIpIHtcblxuICAgIHRoaXMuZmV0Y2hUYXNrcyA9IGZ1bmN0aW9uKHNlc3Npb24sIHByb2plY3RfaWQsIHBhZ2luZ19zaXplLCBwYWdpbmdfb2Zmc2V0LCBjb25kaXRpb25fa2V5d29yZHMsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcycsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9uLCBwcm9qZWN0X2lkOiBwcm9qZWN0X2lkLCBwYWdpbmdfc2l6ZTogcGFnaW5nX3NpemUsIHBhZ2luZ19vZmZzZXQ6IHBhZ2luZ19vZmZzZXQsIGNvbmRpdGlvbl9rZXl3b3JkczogY29uZGl0aW9uX2tleXdvcmRzfSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBkYXRlO1xuICAgICAgICAgICAgdmFyIHJPYmogPSB7fTtcbiAgICAgICAgICAgIHZhciB0b21vcnJvdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB0b21vcnJvdy5zZXREYXRlKHRvbW9ycm93LmdldERhdGUoKSAtIDEpO1xuXG4gICAgICAgICAgICByZXNwb25zZS5kYXRhLnRhc2tzLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICAgICAgdmFyIHRhc2tEYXRlID0gbmV3IERhdGUoaXRlbS5UYXNrLmNyZWF0ZWRfYXQpO1xuXG4gICAgICAgICAgICAgICAgaXRlbS5UYXNrLmRhdGUgPSAkZmlsdGVyKCdkYXRlJykodGFza0RhdGUsICdFRUVFJykgKyAnICgnICsgJGZpbHRlcignZGF0ZScpKHRhc2tEYXRlLCAnZGQuTU0ueXl5eScpICsgJyknO1xuXG4gICAgICAgICAgICAgICAgaWYoJGZpbHRlcignZGF0ZScpKG5ldyBEYXRlKCksICdkZC5NTS55eXl5JykgPT0gJGZpbHRlcignZGF0ZScpKHRhc2tEYXRlLCAnZGQuTU0ueXl5eScpKVxuICAgICAgICAgICAgICAgICAgICBpdGVtLlRhc2suZGF0ZSA9IFwiVG9kYXlcIjtcbiAgICAgICAgICAgICAgICBlbHNlIGlmKCRmaWx0ZXIoJ2RhdGUnKSh0b21vcnJvdywgJ2RkLk1NLnl5eXknKSA9PSAkZmlsdGVyKCdkYXRlJykodGFza0RhdGUsICdkZC5NTS55eXl5JykpXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uVGFzay5kYXRlID0gXCJZZXN0ZXJkYXlcIjtcblxuICAgICAgICAgICAgICAgIGlmKGl0ZW0uVGFzay50aXRsZSAhPSBudWxsKXtcbiAgICAgICAgICAgICAgICAgICAgaWYoaXRlbS5UYXNrLmRhdGUgPT0gZGF0ZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByT2JqW2RhdGVdLnB1c2goaXRlbS5UYXNrKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUgPSBpdGVtLlRhc2suZGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJPYmpbZGF0ZV0gPSBbaXRlbS5UYXNrXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY2FsbGJhY2soe1xuICAgICAgICAgICAgICAgIHRhc2tzOiByT2JqLFxuICAgICAgICAgICAgICAgIHRvdGFsX2NvdW50OiByZXNwb25zZS5kYXRhLnRvdGFsX2NvdW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBmZXRjaFRhc2tzIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmZldGNoVGFzayA9IGZ1bmN0aW9uIChzZXNzaW9uICwgdGFza19pZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzL3Rhc2snLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbiwgdGFza19pZDogdGFza19pZH0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLlRhc2spO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGZldGNoUHJvamVjdCBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5jcmVhdGVUYXNrID0gZnVuY3Rpb24oc2Vzc2lvbiwgcHJvamVjdF9pZCwgdGl0bGUsIGRlc2NyaXB0aW9uLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzL3Rhc2snLFxuICAgICAgICAgICAgZGF0YToge3Nlc3Npb246IHNlc3Npb24sIFByb2plY3Q6IHtpZDogcHJvamVjdF9pZH0sIFRhc2s6IHt0aXRsZTogdGl0bGUsIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbn19LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5UYXNrKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBjcmVhdGVUYXNrIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLnVwZGF0ZVRhc2sgPSBmdW5jdGlvbihzZXNzaW9uLCBpZCwgdGl0bGUsIGRlc2NyaXB0aW9uLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzL3Rhc2snLFxuICAgICAgICAgICAgZGF0YToge3Nlc3Npb246IHNlc3Npb24sIFRhc2s6IHtpZDogaWQsIHRpdGxlOiB0aXRsZSwgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9ufX0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSB1cGRhdGVUYXNrIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmRlbGV0ZVRhc2sgPSBmdW5jdGlvbihzZXNzaW9uLCBpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzL3Rhc2snLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbiwgdGFza19pZDogaWR9LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZGVsZXRlVGFzayBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbXBsaXRlVGFzayA9IGZ1bmN0aW9uKHNlc3Npb24sIGlkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzL3Rhc2snLFxuICAgICAgICAgICAgZGF0YToge3Nlc3Npb246IHNlc3Npb24sIFRhc2s6IHtpZDogaWR9fSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGRlbGV0ZVRhc2sgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cbmFwcC5kaXJlY3RpdmUoJ3Byb2plY3RzTGlzdCcsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiBcIkFFXCIsXG4gICAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL3Byb2plY3RzLnRwbC5odG1sXCJcbiAgICB9XG59KTtcbmFwcC5kaXJlY3RpdmUoJ3doZW5TY3JvbGxlZCcsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBmdW5jdGlvbihzY29wZSwgZWxtLCBhdHRyKSB7XG4gICAgICAgIHZhciByYXcgPSBlbG1bMF07XG5cbiAgICAgICAgZWxtLmJpbmQoJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHJhdy5zY3JvbGxUb3AgKyByYXcub2Zmc2V0SGVpZ2h0ID49IHJhdy5zY3JvbGxIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoYXR0ci53aGVuU2Nyb2xsZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufSk7Il19
