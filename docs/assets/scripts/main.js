!function(n,c){"use strict";function l(b,a,g){var d=g.baseHref(),k=b[0];return function(b,e,f){var g,h;f=f||{},h=f.expires,g=c.isDefined(f.path)?f.path:d,c.isUndefined(e)&&(h="Thu, 01 Jan 1970 00:00:00 GMT",e=""),c.isString(h)&&(h=new Date(h)),e=encodeURIComponent(b)+"="+encodeURIComponent(e),e=e+(g?";path="+g:"")+(f.domain?";domain="+f.domain:""),e+=h?";expires="+h.toUTCString():"",e+=f.secure?";secure":"",f=e.length+1,4096<f&&a.warn("Cookie '"+b+"' possibly not set or overflowed because it was too large ("+f+" > 4096 bytes)!"),k.cookie=e}}c.module("ngCookies",["ng"]).provider("$cookies",[function(){var b=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function(a,g){return{get:function(d){return a()[d]},getObject:function(d){return(d=this.get(d))?c.fromJson(d):d},getAll:function(){return a()},put:function(d,a,m){g(d,a,m?c.extend({},b,m):b)},putObject:function(d,b,a){this.put(d,c.toJson(b),a)},remove:function(a,k){g(a,void 0,k?c.extend({},b,k):b)}}}]}]),c.module("ngCookies").factory("$cookieStore",["$cookies",function(b){return{get:function(a){return b.getObject(a)},put:function(a,c){b.putObject(a,c)},remove:function(a){b.remove(a)}}}]),l.$inject=["$document","$log","$browser"],c.module("ngCookies").provider("$$cookieWriter",function(){this.$get=l})}(window,window.angular);var app=angular.module("TestFrontend",["ngMaterial","ngCookies"]);app.controller("MainCtrl",function($scope,$mdSidenav,$cookies,Account,Project,Task){function getAccountData(){Account.fetchAccount($cookies.get("userSessionKey"),function(data){$scope.account=data})}function getProjects(){Project.fetchProjects($cookies.get("userSessionKey"),function(data){$scope.projects=data})}function getTasks(){0!=$scope.project.id?($scope.content="views/tasks.tpl.html",Task.fetchTasks($cookies.get("userSessionKey"),$scope.project.id,$scope.sizeTask,0,$scope.search,function(data){$scope.tasks=data.tasks,$scope.sizeTask>=data.total_count?$scope.isAllTasks=!0:$scope.isAllTasks=!1,$scope.countTask=data.total_count})):$scope.content="views/select_project.tpl.html"}function buildToggler(componentId){return function(){$mdSidenav(componentId).toggle()}}$scope.loading=!0,$scope.stepTask=3,$scope.countTask=0,$scope.project={id:0},"string"!=typeof $cookies.get("userSessionKey")?($scope.loading=!0,Account.createNewUser(function(data){$cookies.put("userSessionKey",data.session),getAccountData(),getProjects(),$scope.loading=!1})):($scope.loading=!0,Account.checkSession($cookies.get("userSessionKey"),function(){$scope.loading=!1,getAccountData(),getProjects(),$scope.loading=!1})),$scope.$watch("project.id",function(){$scope.sizeTask=13,$scope.search=null,getTasks()}),$scope.$watch("tasks",function(){0==$scope.project.id||0!=$scope.countTask||$scope.search?0==$scope.countTask&&$scope.search&&($scope.content="views/tasks_not.tpl.html"):$scope.content="views/tasks_done.tpl.html"}),$scope.searchTasks=function(){getTasks()},$scope.addProjectBar=function(){delete $scope.newProject,$scope.toggleRight(),$scope.rightBar="views/project_add.tpl.html"},$scope.showTaskBar=function(taskId){Task.fetchTask($cookies.get("userSessionKey"),taskId,function(data){$scope.task=data,$scope.toggleRight(),$scope.rightBar="views/task.tpl.html"})},$scope.editProjectBar=function(){$scope.toggleRight(),$scope.project.newTitle=$scope.project.title,$scope.rightBar="views/project_edit.tpl.html"},$scope.addTaskBar=function(){delete $scope.newTask,$scope.toggleRight(),$scope.rightBar="views/task_add.tpl.html"},$scope.editTaskBar=function(){$scope.rightBar="views/task_edit.tpl.html"},$scope.addProject=function(){Project.createProject($cookies.get("userSessionKey"),$scope.newProject.title,function(){getProjects(),$scope.toggleRight()})},$scope.deleteProject=function(){Project.deleteProject($cookies.get("userSessionKey"),$scope.project.id,function(){getProjects(),delete $scope.project,$scope.content="views/select_project.tpl.html"})},$scope.editProject=function(){Project.updateProject($cookies.get("userSessionKey"),$scope.project.id,$scope.project.newTitle,function(){getProjects(),$scope.toggleRight(),$scope.project.title=$scope.project.newTitle})},$scope.addTask=function(){Task.createTask($cookies.get("userSessionKey"),$scope.project.id,$scope.newTask.title,$scope.newTask.description,function(){getProjects(),getTasks(),$scope.toggleRight()})},$scope.editTask=function(){Task.updateTask($cookies.get("userSessionKey"),$scope.task.id,$scope.task.title,$scope.task.description,function(){getTasks(),$scope.rightBar="views/task.tpl.html"})},$scope.deleteTask=function(){Task.deleteTask($cookies.get("userSessionKey"),$scope.task.id,function(){getProjects(),getTasks(),$scope.toggleRight()})},$scope.compliteTask=function(id){Task.compliteTask($cookies.get("userSessionKey"),id,function(){getProjects(),getTasks()})},$scope.loadMoreTasks=function(){$scope.isAllTasks||($scope.sizeTask=$scope.sizeTask+$scope.stepTask,$scope.sizeTask>$scope.countTask&&($scope.sizeTask=$scope.countTask),getTasks())},$scope.openMenu=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},$scope.toggleRight=buildToggler("right")}),app.service("Account",function($http,$log){this.createNewUser=function(callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/signup"}).then(function(response){callback(response.data)},function(){$log.error("API createNewUser error")})},this.checkSession=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/session",params:{session:session}}).then(function(response){callback(response)},function(){$log.error("API checkSession error")})},this.fetchAccount=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/account",params:{session:session}}).then(function(response){callback(response.data.Account)},function(){$log.error("API fetchAccount error")})}}),app.service("Project",function($http,$log){this.fetchProjects=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects",params:{session:session}}).then(function(response){callback(response.data.projects)},function(){$log.error("API fetchProjects error")})},this.fetchProject=function(session,project_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:project_id}}).then(function(response){callback(response)},function(){$log.error("API fetchProject error")})},this.createProject=function(session,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API createProject error")})},this.updateProject=function(session,id,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{id:id,title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API updateProject error")})},this.deleteProject=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:id}}).then(function(response){callback(response.data.Account)},function(){$log.error("API deleteProject error")})}}),app.service("Task",function($http,$log,$filter){this.fetchTasks=function(session,project_id,paging_size,paging_offset,condition_keywords,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks",params:{session:session,project_id:project_id,paging_size:paging_size,paging_offset:paging_offset,condition_keywords:condition_keywords}}).then(function(response){var date,rObj={},tomorrow=new Date;tomorrow.setDate(tomorrow.getDate()-1),response.data.tasks.forEach(function(item){var taskDate=new Date(item.Task.created_at);item.Task.date=$filter("date")(taskDate,"EEEE")+" ("+$filter("date")(taskDate,"dd.MM.yyyy")+")",$filter("date")(new Date,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")?item.Task.date="Today":$filter("date")(tomorrow,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")&&(item.Task.date="Yesterday"),null!=item.Task.title&&(item.Task.date==date?rObj[date].push(item.Task):(date=item.Task.date,rObj[date]=[item.Task]))}),callback({tasks:rObj,total_count:response.data.total_count})},function(){$log.error("API fetchTasks error")})},this.fetchTask=function(session,task_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:task_id}}).then(function(response){callback(response.data.Task)},function(){$log.error("API fetchProject error")})},this.createTask=function(session,project_id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Project:{id:project_id},Task:{title:title,description:description}}}).then(function(response){callback(response.data.Task)},function(){$log.error("API createTask error")})},this.updateTask=function(session,id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id,title:title,description:description}}}).then(function(response){callback(response.data)},function(){$log.error("API updateTask error")})},this.deleteTask=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:id}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})},this.compliteTask=function(session,id,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id}}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})}}),app.directive("projectsList",function(){return{restrict:"AE",templateUrl:"views/projects.tpl.html"}}),app.directive("whenScrolled",function(){return function(scope,elm,attr){var raw=elm[0];elm.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight&&scope.$apply(attr.whenScrolled)})}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibiIsImMiLCJsIiwiYiIsImEiLCJnIiwiZCIsImJhc2VIcmVmIiwiayIsImUiLCJmIiwiaCIsImV4cGlyZXMiLCJpc0RlZmluZWQiLCJwYXRoIiwiaXNVbmRlZmluZWQiLCJpc1N0cmluZyIsIkRhdGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJkb21haW4iLCJ0b1VUQ1N0cmluZyIsInNlY3VyZSIsImxlbmd0aCIsIndhcm4iLCJjb29raWUiLCJtb2R1bGUiLCJwcm92aWRlciIsInRoaXMiLCJkZWZhdWx0cyIsIiRnZXQiLCJnZXQiLCJnZXRPYmplY3QiLCJmcm9tSnNvbiIsImdldEFsbCIsInB1dCIsIm0iLCJleHRlbmQiLCJwdXRPYmplY3QiLCJ0b0pzb24iLCJyZW1vdmUiLCJmYWN0b3J5IiwiJGluamVjdCIsIndpbmRvdyIsImFuZ3VsYXIiLCJhcHAiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJG1kU2lkZW5hdiIsIiRjb29raWVzIiwiQWNjb3VudCIsIlByb2plY3QiLCJUYXNrIiwiZ2V0QWNjb3VudERhdGEiLCJmZXRjaEFjY291bnQiLCJkYXRhIiwiYWNjb3VudCIsImdldFByb2plY3RzIiwiZmV0Y2hQcm9qZWN0cyIsInByb2plY3RzIiwiZ2V0VGFza3MiLCJwcm9qZWN0IiwiaWQiLCJjb250ZW50IiwiZmV0Y2hUYXNrcyIsInNpemVUYXNrIiwic2VhcmNoIiwidGFza3MiLCJ0b3RhbF9jb3VudCIsImlzQWxsVGFza3MiLCJjb3VudFRhc2siLCJidWlsZFRvZ2dsZXIiLCJjb21wb25lbnRJZCIsInRvZ2dsZSIsImxvYWRpbmciLCJzdGVwVGFzayIsImNyZWF0ZU5ld1VzZXIiLCJzZXNzaW9uIiwiY2hlY2tTZXNzaW9uIiwiJHdhdGNoIiwic2VhcmNoVGFza3MiLCJhZGRQcm9qZWN0QmFyIiwibmV3UHJvamVjdCIsInRvZ2dsZVJpZ2h0IiwicmlnaHRCYXIiLCJzaG93VGFza0JhciIsInRhc2tJZCIsImZldGNoVGFzayIsInRhc2siLCJlZGl0UHJvamVjdEJhciIsIm5ld1RpdGxlIiwidGl0bGUiLCJhZGRUYXNrQmFyIiwibmV3VGFzayIsImVkaXRUYXNrQmFyIiwiYWRkUHJvamVjdCIsImNyZWF0ZVByb2plY3QiLCJkZWxldGVQcm9qZWN0IiwiZWRpdFByb2plY3QiLCJ1cGRhdGVQcm9qZWN0IiwiYWRkVGFzayIsImNyZWF0ZVRhc2siLCJkZXNjcmlwdGlvbiIsImVkaXRUYXNrIiwidXBkYXRlVGFzayIsImRlbGV0ZVRhc2siLCJjb21wbGl0ZVRhc2siLCJsb2FkTW9yZVRhc2tzIiwib3Blbk1lbnUiLCIkbWRPcGVuTWVudSIsImV2Iiwib3JpZ2luYXRvckV2Iiwic2VydmljZSIsIiRodHRwIiwiJGxvZyIsImNhbGxiYWNrIiwibWV0aG9kIiwidXJsIiwidGhlbiIsInJlc3BvbnNlIiwiZXJyb3IiLCJwYXJhbXMiLCJmZXRjaFByb2plY3QiLCJwcm9qZWN0X2lkIiwiJGZpbHRlciIsInBhZ2luZ19zaXplIiwicGFnaW5nX29mZnNldCIsImNvbmRpdGlvbl9rZXl3b3JkcyIsImRhdGUiLCJyT2JqIiwidG9tb3Jyb3ciLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImZvckVhY2giLCJpdGVtIiwidGFza0RhdGUiLCJjcmVhdGVkX2F0IiwicHVzaCIsInRhc2tfaWQiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInRlbXBsYXRlVXJsIiwic2NvcGUiLCJlbG0iLCJhdHRyIiwicmF3IiwiYmluZCIsInNjcm9sbFRvcCIsIm9mZnNldEhlaWdodCIsInNjcm9sbEhlaWdodCIsIiRhcHBseSIsIndoZW5TY3JvbGxlZCJdLCJtYXBwaW5ncyI6IkNBU0EsU0FBVUEsRUFBRUMsR0FBRyxZQUFhLFNBQVNDLEdBQUVDLEVBQUVDLEVBQUVDLEdBQUcsR0FBSUMsR0FBRUQsRUFBRUUsV0FBV0MsRUFBRUwsRUFBRSxFQUFHLE9BQU8sVUFBU0EsRUFBRU0sRUFBRUMsR0FBRyxHQUFJTCxHQUFFTSxDQUFFRCxHQUFFQSxNQUFNQyxFQUFFRCxF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Q3hDUCxNQUFNUSxPQUFPTixLQUFLTyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IEpleGltIG9uIDE5LjEwLjE2LlxuICovXG5cbi8qXG4gQW5ndWxhckpTIHYxLjUuOFxuIChjKSAyMDEwLTIwMTYgR29vZ2xlLCBJbmMuIGh0dHA6Ly9hbmd1bGFyanMub3JnXG4gTGljZW5zZTogTUlUXG4qL1xuKGZ1bmN0aW9uKG4sYyl7J3VzZSBzdHJpY3QnO2Z1bmN0aW9uIGwoYixhLGcpe3ZhciBkPWcuYmFzZUhyZWYoKSxrPWJbMF07cmV0dXJuIGZ1bmN0aW9uKGIsZSxmKXt2YXIgZyxoO2Y9Znx8e307aD1mLmV4cGlyZXM7Zz1jLmlzRGVmaW5lZChmLnBhdGgpP2YucGF0aDpkO2MuaXNVbmRlZmluZWQoZSkmJihoPVwiVGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBHTVRcIixlPVwiXCIpO2MuaXNTdHJpbmcoaCkmJihoPW5ldyBEYXRlKGgpKTtlPWVuY29kZVVSSUNvbXBvbmVudChiKStcIj1cIitlbmNvZGVVUklDb21wb25lbnQoZSk7ZT1lKyhnP1wiO3BhdGg9XCIrZzpcIlwiKSsoZi5kb21haW4/XCI7ZG9tYWluPVwiK2YuZG9tYWluOlwiXCIpO2UrPWg/XCI7ZXhwaXJlcz1cIitoLnRvVVRDU3RyaW5nKCk6XCJcIjtlKz1mLnNlY3VyZT9cIjtzZWN1cmVcIjpcIlwiO2Y9ZS5sZW5ndGgrMTs0MDk2PGYmJmEud2FybihcIkNvb2tpZSAnXCIrYitcIicgcG9zc2libHkgbm90IHNldCBvciBvdmVyZmxvd2VkIGJlY2F1c2UgaXQgd2FzIHRvbyBsYXJnZSAoXCIrXG5mK1wiID4gNDA5NiBieXRlcykhXCIpO2suY29va2llPWV9fWMubW9kdWxlKFwibmdDb29raWVzXCIsW1wibmdcIl0pLnByb3ZpZGVyKFwiJGNvb2tpZXNcIixbZnVuY3Rpb24oKXt2YXIgYj10aGlzLmRlZmF1bHRzPXt9O3RoaXMuJGdldD1bXCIkJGNvb2tpZVJlYWRlclwiLFwiJCRjb29raWVXcml0ZXJcIixmdW5jdGlvbihhLGcpe3JldHVybntnZXQ6ZnVuY3Rpb24oZCl7cmV0dXJuIGEoKVtkXX0sZ2V0T2JqZWN0OmZ1bmN0aW9uKGQpe3JldHVybihkPXRoaXMuZ2V0KGQpKT9jLmZyb21Kc29uKGQpOmR9LGdldEFsbDpmdW5jdGlvbigpe3JldHVybiBhKCl9LHB1dDpmdW5jdGlvbihkLGEsbSl7ZyhkLGEsbT9jLmV4dGVuZCh7fSxiLG0pOmIpfSxwdXRPYmplY3Q6ZnVuY3Rpb24oZCxiLGEpe3RoaXMucHV0KGQsYy50b0pzb24oYiksYSl9LHJlbW92ZTpmdW5jdGlvbihhLGspe2coYSx2b2lkIDAsaz9jLmV4dGVuZCh7fSxiLGspOmIpfX19XX1dKTtjLm1vZHVsZShcIm5nQ29va2llc1wiKS5mYWN0b3J5KFwiJGNvb2tpZVN0b3JlXCIsXG5bXCIkY29va2llc1wiLGZ1bmN0aW9uKGIpe3JldHVybntnZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGIuZ2V0T2JqZWN0KGEpfSxwdXQ6ZnVuY3Rpb24oYSxjKXtiLnB1dE9iamVjdChhLGMpfSxyZW1vdmU6ZnVuY3Rpb24oYSl7Yi5yZW1vdmUoYSl9fX1dKTtsLiRpbmplY3Q9W1wiJGRvY3VtZW50XCIsXCIkbG9nXCIsXCIkYnJvd3NlclwiXTtjLm1vZHVsZShcIm5nQ29va2llc1wiKS5wcm92aWRlcihcIiQkY29va2llV3JpdGVyXCIsZnVuY3Rpb24oKXt0aGlzLiRnZXQ9bH0pfSkod2luZG93LHdpbmRvdy5hbmd1bGFyKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFuZ3VsYXItY29va2llcy5taW4uanMubWFwXG5cbi8qKlxuICogQ3JlYXRlZCBieSBKZXhpbSBvbiAxOS4xMC4xNi5cbiAqL1xuXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ1Rlc3RGcm9udGVuZCcsIFsnbmdNYXRlcmlhbCcsICduZ0Nvb2tpZXMnXSk7XG5cbmFwcC5jb250cm9sbGVyKCdNYWluQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRtZFNpZGVuYXYsICRjb29raWVzLCBBY2NvdW50LCBQcm9qZWN0LCBUYXNrKXtcblxuICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAkc2NvcGUuc3RlcFRhc2sgPSAzO1xuICAgICRzY29wZS5jb3VudFRhc2sgPSAwO1xuICAgICRzY29wZS5wcm9qZWN0ID0geyBpZDogMCB9O1xuXG4gICAgaWYodHlwZW9mICRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSAhPSAnc3RyaW5nJyl7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgQWNjb3VudC5jcmVhdGVOZXdVc2VyKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgJGNvb2tpZXMucHV0KCd1c2VyU2Vzc2lvbktleScsIGRhdGEuc2Vzc2lvbik7XG4gICAgICAgICAgICBnZXRBY2NvdW50RGF0YSgpO1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgQWNjb3VudC5jaGVja1Nlc3Npb24oJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICBnZXRBY2NvdW50RGF0YSgpO1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgICRzY29wZS4kd2F0Y2goJ3Byb2plY3QuaWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnNpemVUYXNrID0gMTM7XG4gICAgICAgICRzY29wZS5zZWFyY2ggPSBudWxsO1xuICAgICAgICBnZXRUYXNrcygpO1xuICAgIH0pO1xuXG4gICAgLy8kc2NvcGUuJHdhdGNoKCdzZWFyY2gnLCBmdW5jdGlvbigpIHtcbiAgICAvLyAgICBnZXRUYXNrcygpO1xuICAgIC8vfSk7XG5cbiAgICAkc2NvcGUuJHdhdGNoKCd0YXNrcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYoJHNjb3BlLnByb2plY3QuaWQgIT0gMCAmJiAkc2NvcGUuY291bnRUYXNrID09IDAgJiYgISRzY29wZS5zZWFyY2gpe1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3MvdGFza3NfZG9uZS50cGwuaHRtbCc7XG4gICAgICAgIH0gZWxzZSBpZigkc2NvcGUuY291bnRUYXNrID09IDAgJiYgJHNjb3BlLnNlYXJjaCkge1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3MvdGFza3Nfbm90LnRwbC5odG1sJztcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgJHNjb3BlLnNlYXJjaFRhc2tzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGdldFRhc2tzKCk7XG4gICAgfTtcblxuICAgICRzY29wZS5hZGRQcm9qZWN0QmFyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGRlbGV0ZSAkc2NvcGUubmV3UHJvamVjdDtcbiAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy9wcm9qZWN0X2FkZC50cGwuaHRtbCc7XG4gICAgfTtcblxuICAgICRzY29wZS5zaG93VGFza0JhciA9IGZ1bmN0aW9uKHRhc2tJZCkge1xuICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgVGFzay5mZXRjaFRhc2soJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCB0YXNrSWQsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgJHNjb3BlLnRhc2sgPSBkYXRhO1xuICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvdGFzay50cGwuaHRtbCc7XG4gICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZWRpdFByb2plY3RCYXIgID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAkc2NvcGUucHJvamVjdC5uZXdUaXRsZSA9ICRzY29wZS5wcm9qZWN0LnRpdGxlO1xuICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvcHJvamVjdF9lZGl0LnRwbC5odG1sJztcbiAgICB9O1xuXG5cbiAgICAkc2NvcGUuYWRkVGFza0JhciAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgZGVsZXRlICRzY29wZS5uZXdUYXNrO1xuICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgJHNjb3BlLnJpZ2h0QmFyID0gJ3ZpZXdzL3Rhc2tfYWRkLnRwbC5odG1sJztcbiAgICB9O1xuXG4gICAgJHNjb3BlLmVkaXRUYXNrQmFyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy90YXNrX2VkaXQudHBsLmh0bWwnO1xuICAgIH07XG5cbiAgICAkc2NvcGUuYWRkUHJvamVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgUHJvamVjdC5jcmVhdGVQcm9qZWN0KCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgJHNjb3BlLm5ld1Byb2plY3QudGl0bGUsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmRlbGV0ZVByb2plY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFByb2plY3QuZGVsZXRlUHJvamVjdCgkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksICRzY29wZS5wcm9qZWN0LmlkLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICBkZWxldGUgJHNjb3BlLnByb2plY3Q7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy9zZWxlY3RfcHJvamVjdC50cGwuaHRtbCc7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZWRpdFByb2plY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFByb2plY3QudXBkYXRlUHJvamVjdCgkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksICRzY29wZS5wcm9qZWN0LmlkLCAkc2NvcGUucHJvamVjdC5uZXdUaXRsZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICAgICAkc2NvcGUucHJvamVjdC50aXRsZSA9ICRzY29wZS5wcm9qZWN0Lm5ld1RpdGxlO1xuICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG5cbiAgICAkc2NvcGUuYWRkVGFzayAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFRhc2suY3JlYXRlVGFzayhcbiAgICAgICAgICAgICRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSxcbiAgICAgICAgICAgICRzY29wZS5wcm9qZWN0LmlkLFxuICAgICAgICAgICAgJHNjb3BlLm5ld1Rhc2sudGl0bGUsXG4gICAgICAgICAgICAkc2NvcGUubmV3VGFzay5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfTtcblxuICAgICRzY29wZS5lZGl0VGFzayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgVGFzay51cGRhdGVUYXNrKFxuICAgICAgICAgICAgJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLFxuICAgICAgICAgICAgJHNjb3BlLnRhc2suaWQsXG4gICAgICAgICAgICAkc2NvcGUudGFzay50aXRsZSxcbiAgICAgICAgICAgICRzY29wZS50YXNrLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvdGFzay50cGwuaHRtbCc7XG4gICAgICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZGVsZXRlVGFzayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgVGFzay5kZWxldGVUYXNrKCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgJHNjb3BlLnRhc2suaWQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICBnZXRUYXNrcygpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuY29tcGxpdGVUYXNrID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFRhc2suY29tcGxpdGVUYXNrKCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgaWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgIGdldFRhc2tzKCk7XG4gICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUubG9hZE1vcmVUYXNrcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYoISRzY29wZS5pc0FsbFRhc2tzKXtcbiAgICAgICAgICAgICRzY29wZS5zaXplVGFzayA9ICRzY29wZS5zaXplVGFzayArICRzY29wZS5zdGVwVGFzaztcbiAgICAgICAgICAgIGlmKCRzY29wZS5zaXplVGFzayA+ICRzY29wZS5jb3VudFRhc2spXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNpemVUYXNrID0gJHNjb3BlLmNvdW50VGFzaztcbiAgICAgICAgICAgIGdldFRhc2tzKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLm9wZW5NZW51ID0gZnVuY3Rpb24oJG1kT3Blbk1lbnUsIGV2KSB7XG4gICAgICAgIG9yaWdpbmF0b3JFdiA9IGV2O1xuICAgICAgICAkbWRPcGVuTWVudShldik7XG4gICAgfTtcblxuICAgICRzY29wZS50b2dnbGVSaWdodCA9IGJ1aWxkVG9nZ2xlcigncmlnaHQnKTtcblxuICAgIGZ1bmN0aW9uIGdldEFjY291bnREYXRhKCkge1xuICAgICAgICBBY2NvdW50LmZldGNoQWNjb3VudCgkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS5hY2NvdW50ID0gZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0UHJvamVjdHMoKSB7XG4gICAgICAgIFByb2plY3QuZmV0Y2hQcm9qZWN0cygkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS5wcm9qZWN0cyA9IGRhdGE7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFRhc2tzKCkge1xuICAgICAgICBpZigkc2NvcGUucHJvamVjdC5pZCAhPSAwKXtcbiAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3MvdGFza3MudHBsLmh0bWwnO1xuICAgICAgICAgICAgVGFzay5mZXRjaFRhc2tzKFxuICAgICAgICAgICAgICAgICRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSxcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZVRhc2ssXG4gICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VhcmNoLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRhc2tzID0gZGF0YS50YXNrcztcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNpemVUYXNrID49IGRhdGEudG90YWxfY291bnQgPyAkc2NvcGUuaXNBbGxUYXNrcyA9IHRydWUgOiAkc2NvcGUuaXNBbGxUYXNrcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRUYXNrID0gZGF0YS50b3RhbF9jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy9zZWxlY3RfcHJvamVjdC50cGwuaHRtbCc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBidWlsZFRvZ2dsZXIoY29tcG9uZW50SWQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1kU2lkZW5hdihjb21wb25lbnRJZCkudG9nZ2xlKCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbmFwcC5zZXJ2aWNlKCdBY2NvdW50JywgZnVuY3Rpb24oJGh0dHAsICRsb2cpIHtcblxuICAgIHRoaXMuY3JlYXRlTmV3VXNlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vc2lnbnVwJ1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgY3JlYXRlTmV3VXNlciBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdGhpcy5jaGVja1Nlc3Npb24gPSBmdW5jdGlvbiAoc2Vzc2lvbiAsY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Nlc3Npb24nLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbn0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgY2hlY2tTZXNzaW9uIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB0aGlzLmZldGNoQWNjb3VudCA9IGZ1bmN0aW9uKHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9hY2NvdW50JyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb259LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5BY2NvdW50KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBmZXRjaEFjY291bnQgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5hcHAuc2VydmljZSgnUHJvamVjdCcsIGZ1bmN0aW9uKCRodHRwLCAkbG9nKSB7XG5cbiAgICB0aGlzLmZldGNoUHJvamVjdHMgPSBmdW5jdGlvbihzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vcHJvamVjdHMnLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbn0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLnByb2plY3RzKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBmZXRjaFByb2plY3RzIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmZldGNoUHJvamVjdCA9IGZ1bmN0aW9uIChzZXNzaW9uICwgcHJvamVjdF9pZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Byb2plY3RzL3Byb2plY3QnLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbiwgcHJvamVjdF9pZDogcHJvamVjdF9pZH0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hQcm9qZWN0IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmNyZWF0ZVByb2plY3QgPSBmdW5jdGlvbihzZXNzaW9uLCB0aXRsZSwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cy9wcm9qZWN0JyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBQcm9qZWN0OiB7IHRpdGxlOiB0aXRsZSB9fSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuQWNjb3VudCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgY3JlYXRlUHJvamVjdCBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy51cGRhdGVQcm9qZWN0ID0gZnVuY3Rpb24oc2Vzc2lvbiwgaWQsIHRpdGxlLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Byb2plY3RzL3Byb2plY3QnLFxuICAgICAgICAgICAgZGF0YToge3Nlc3Npb246IHNlc3Npb24sIFByb2plY3Q6IHsgaWQ6IGlkLCB0aXRsZTogdGl0bGUgfX0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLkFjY291bnQpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIHVwZGF0ZVByb2plY3QgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVsZXRlUHJvamVjdCA9IGZ1bmN0aW9uKHNlc3Npb24sIGlkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vcHJvamVjdHMvcHJvamVjdCcsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9uLCBwcm9qZWN0X2lkOiBpZH0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLkFjY291bnQpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGRlbGV0ZVByb2plY3QgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5hcHAuc2VydmljZSgnVGFzaycsIGZ1bmN0aW9uKCRodHRwLCAkbG9nLCAkZmlsdGVyKSB7XG5cbiAgICB0aGlzLmZldGNoVGFza3MgPSBmdW5jdGlvbihzZXNzaW9uLCBwcm9qZWN0X2lkLCBwYWdpbmdfc2l6ZSwgcGFnaW5nX29mZnNldCwgY29uZGl0aW9uX2tleXdvcmRzLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MnLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbiwgcHJvamVjdF9pZDogcHJvamVjdF9pZCwgcGFnaW5nX3NpemU6IHBhZ2luZ19zaXplLCBwYWdpbmdfb2Zmc2V0OiBwYWdpbmdfb2Zmc2V0LCBjb25kaXRpb25fa2V5d29yZHM6IGNvbmRpdGlvbl9rZXl3b3Jkc30sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgZGF0ZTtcbiAgICAgICAgICAgIHZhciByT2JqID0ge307XG4gICAgICAgICAgICB2YXIgdG9tb3Jyb3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgdG9tb3Jyb3cuc2V0RGF0ZSh0b21vcnJvdy5nZXREYXRlKCkgLSAxKTtcblxuICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS50YXNrcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgICAgIHZhciB0YXNrRGF0ZSA9IG5ldyBEYXRlKGl0ZW0uVGFzay5jcmVhdGVkX2F0KTtcblxuICAgICAgICAgICAgICAgIGl0ZW0uVGFzay5kYXRlID0gJGZpbHRlcignZGF0ZScpKHRhc2tEYXRlLCAnRUVFRScpICsgJyAoJyArICRmaWx0ZXIoJ2RhdGUnKSh0YXNrRGF0ZSwgJ2RkLk1NLnl5eXknKSArICcpJztcblxuICAgICAgICAgICAgICAgIGlmKCRmaWx0ZXIoJ2RhdGUnKShuZXcgRGF0ZSgpLCAnZGQuTU0ueXl5eScpID09ICRmaWx0ZXIoJ2RhdGUnKSh0YXNrRGF0ZSwgJ2RkLk1NLnl5eXknKSlcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5UYXNrLmRhdGUgPSBcIlRvZGF5XCI7XG4gICAgICAgICAgICAgICAgZWxzZSBpZigkZmlsdGVyKCdkYXRlJykodG9tb3Jyb3csICdkZC5NTS55eXl5JykgPT0gJGZpbHRlcignZGF0ZScpKHRhc2tEYXRlLCAnZGQuTU0ueXl5eScpKVxuICAgICAgICAgICAgICAgICAgICBpdGVtLlRhc2suZGF0ZSA9IFwiWWVzdGVyZGF5XCI7XG5cbiAgICAgICAgICAgICAgICBpZihpdGVtLlRhc2sudGl0bGUgIT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0uVGFzay5kYXRlID09IGRhdGUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgck9ialtkYXRlXS5wdXNoKGl0ZW0uVGFzayk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gaXRlbS5UYXNrLmRhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICByT2JqW2RhdGVdID0gW2l0ZW0uVGFza107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICB0YXNrczogck9iaixcbiAgICAgICAgICAgICAgICB0b3RhbF9jb3VudDogcmVzcG9uc2UuZGF0YS50b3RhbF9jb3VudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hUYXNrcyBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5mZXRjaFRhc2sgPSBmdW5jdGlvbiAoc2Vzc2lvbiAsIHRhc2tfaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb24sIHRhc2tfaWQ6IHRhc2tfaWR9LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5UYXNrKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBmZXRjaFByb2plY3QgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuY3JlYXRlVGFzayA9IGZ1bmN0aW9uKHNlc3Npb24sIHByb2plY3RfaWQsIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBQcm9qZWN0OiB7aWQ6IHByb2plY3RfaWR9LCBUYXNrOiB7dGl0bGU6IHRpdGxlLCBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb259fSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuVGFzayk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgY3JlYXRlVGFzayBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy51cGRhdGVUYXNrID0gZnVuY3Rpb24oc2Vzc2lvbiwgaWQsIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBUYXNrOiB7aWQ6IGlkLCB0aXRsZTogdGl0bGUsIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbn19LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgdXBkYXRlVGFzayBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZWxldGVUYXNrID0gZnVuY3Rpb24oc2Vzc2lvbiwgaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb24sIHRhc2tfaWQ6IGlkfSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGRlbGV0ZVRhc2sgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5jb21wbGl0ZVRhc2sgPSBmdW5jdGlvbihzZXNzaW9uLCBpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBUYXNrOiB7aWQ6IGlkfX0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBkZWxldGVUYXNrIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuXG5hcHAuZGlyZWN0aXZlKCdwcm9qZWN0c0xpc3QnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogXCJBRVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9wcm9qZWN0cy50cGwuaHRtbFwiXG4gICAgfVxufSk7XG5hcHAuZGlyZWN0aXZlKCd3aGVuU2Nyb2xsZWQnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsbSwgYXR0cikge1xuICAgICAgICB2YXIgcmF3ID0gZWxtWzBdO1xuXG4gICAgICAgIGVsbS5iaW5kKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChyYXcuc2Nyb2xsVG9wICsgcmF3Lm9mZnNldEhlaWdodCA+PSByYXcuc2Nyb2xsSGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGF0dHIud2hlblNjcm9sbGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbn0pOyJdfQ==
