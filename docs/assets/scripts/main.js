!function(n,c){"use strict";function l(b,a,g){var d=g.baseHref(),k=b[0];return function(b,e,f){var g,h;f=f||{},h=f.expires,g=c.isDefined(f.path)?f.path:d,c.isUndefined(e)&&(h="Thu, 01 Jan 1970 00:00:00 GMT",e=""),c.isString(h)&&(h=new Date(h)),e=encodeURIComponent(b)+"="+encodeURIComponent(e),e=e+(g?";path="+g:"")+(f.domain?";domain="+f.domain:""),e+=h?";expires="+h.toUTCString():"",e+=f.secure?";secure":"",f=e.length+1,4096<f&&a.warn("Cookie '"+b+"' possibly not set or overflowed because it was too large ("+f+" > 4096 bytes)!"),k.cookie=e}}c.module("ngCookies",["ng"]).provider("$cookies",[function(){var b=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function(a,g){return{get:function(d){return a()[d]},getObject:function(d){return(d=this.get(d))?c.fromJson(d):d},getAll:function(){return a()},put:function(d,a,m){g(d,a,m?c.extend({},b,m):b)},putObject:function(d,b,a){this.put(d,c.toJson(b),a)},remove:function(a,k){g(a,void 0,k?c.extend({},b,k):b)}}}]}]),c.module("ngCookies").factory("$cookieStore",["$cookies",function(b){return{get:function(a){return b.getObject(a)},put:function(a,c){b.putObject(a,c)},remove:function(a){b.remove(a)}}}]),l.$inject=["$document","$log","$browser"],c.module("ngCookies").provider("$$cookieWriter",function(){this.$get=l})}(window,window.angular);var app=angular.module("TestFrontend",["ngMaterial","ngCookies"]);app.controller("MainCtrl",function($scope,$mdSidenav,$cookies,Account,Project,Task){function getAccountData(){Account.fetchAccount($cookies.get("userSessionKey"),function(data){$scope.account=data})}function getProjects(){Project.fetchProjects($cookies.get("userSessionKey"),function(data){$scope.projects=data})}function getTasks(){0!=$scope.project.id?($scope.loading=!0,$scope.content="views/tasks.tpl.html",Task.fetchTasks($cookies.get("userSessionKey"),$scope.project.id,$scope.sizeTask,0,$scope.search,function(data){$scope.tasks=data.tasks,$scope.sizeTask>=data.total_count?$scope.isAllTasks=!0:$scope.isAllTasks=!1,$scope.countTask=data.total_count,$scope.loading=!1})):$scope.content="views/select_project.tpl.html"}function buildToggler(componentId){return function(){$mdSidenav(componentId).toggle()}}$scope.loading=!0,$scope.stepTask=3,$scope.isAllTasks=!1,$scope.countTask=0,$scope.project={id:0},"string"!=typeof $cookies.get("userSessionKey")?($scope.loading=!0,Account.createNewUser(function(data){$cookies.put("userSessionKey",data.session),getAccountData(),getProjects(),$scope.loading=!1})):($scope.loading=!0,Account.checkSession($cookies.get("userSessionKey"),function(){$scope.loading=!1,getAccountData(),getProjects(),$scope.loading=!1})),$scope.$watch("project.id",function(){$scope.sizeTask=10,$scope.search=null,getTasks()}),$scope.$watch("search",function(){getTasks()}),$scope.$watch("tasks",function(){0==$scope.project.id||0!=$scope.countTask||$scope.search?0==$scope.countTask&&$scope.search&&($scope.content="views/tasks_not.tpl.html"):$scope.content="views/tasks_done.tpl.html"}),$scope.addProjectBar=function(){delete $scope.newProject,$scope.toggleRight(),$scope.rightBar="views/project_add.tpl.html"},$scope.showTaskBar=function(taskId){$scope.loading=!0,Task.fetchTask($cookies.get("userSessionKey"),taskId,function(data){$scope.task=data,$scope.toggleRight(),$scope.rightBar="views/task.tpl.html",$scope.loading=!1})},$scope.editProjectBar=function(){$scope.toggleRight(),$scope.project.newTitle=$scope.project.title,$scope.rightBar="views/project_edit.tpl.html"},$scope.addTaskBar=function(){delete $scope.newTask,$scope.toggleRight(),$scope.rightBar="views/task_add.tpl.html"},$scope.editTaskBar=function(){$scope.rightBar="views/task_edit.tpl.html"},$scope.addProject=function(){$scope.loading=!0,Project.createProject($cookies.get("userSessionKey"),$scope.newProject.title,function(){getProjects(),$scope.toggleRight(),$scope.loading=!1})},$scope.deleteProject=function(){$scope.loading=!0,Project.deleteProject($cookies.get("userSessionKey"),$scope.project.id,function(){getProjects(),$scope.loading=!1,$scope.content="views/select_project.tpl.html"})},$scope.editProject=function(){$scope.loading=!0,Project.updateProject($cookies.get("userSessionKey"),$scope.project.id,$scope.project.newTitle,function(){getProjects(),$scope.toggleRight(),$scope.project.title=$scope.project.newTitle,$scope.loading=!1})},$scope.addTask=function(){$scope.loading=!0,Task.createTask($cookies.get("userSessionKey"),$scope.project.id,$scope.newTask.title,$scope.newTask.description,function(){getProjects(),getTasks(),$scope.toggleRight(),$scope.loading=!1})},$scope.editTask=function(){$scope.loading=!0,Task.updateTask($cookies.get("userSessionKey"),$scope.task.id,$scope.task.title,$scope.task.description,function(){getTasks(),$scope.rightBar="views/task.tpl.html",$scope.loading=!1})},$scope.deleteTask=function(){$scope.loading=!0,Task.deleteTask($cookies.get("userSessionKey"),$scope.task.id,function(){getProjects(),getTasks(),$scope.toggleRight(),$scope.loading=!1})},$scope.compliteTask=function(id){$scope.loading=!0,Task.compliteTask($cookies.get("userSessionKey"),id,function(){getProjects(),getTasks(),$scope.loading=!1})},$scope.loadMoreTasks=function(){$scope.isAllTasks||($scope.sizeTask=$scope.sizeTask+$scope.stepTask,$scope.sizeTask>$scope.countTask&&($scope.sizeTask=$scope.countTask),getTasks())},$scope.openMenu=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},$scope.toggleRight=buildToggler("right")}),app.service("Account",function($http,$log){this.createNewUser=function(callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/signup"}).then(function(response){callback(response.data)},function(){$log.error("API createNewUser error")})},this.checkSession=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/session",params:{session:session}}).then(function(response){callback(response)},function(){$log.error("API checkSession error")})},this.fetchAccount=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/account",params:{session:session}}).then(function(response){callback(response.data.Account)},function(){$log.error("API fetchAccount error")})}}),app.service("Project",function($http,$log){this.fetchProjects=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects",params:{session:session}}).then(function(response){callback(response.data.projects)},function(){$log.error("API fetchProjects error")})},this.fetchProject=function(session,project_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:project_id}}).then(function(response){callback(response)},function(){$log.error("API fetchProject error")})},this.createProject=function(session,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API createProject error")})},this.updateProject=function(session,id,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{id:id,title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API updateProject error")})},this.deleteProject=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:id}}).then(function(response){callback(response.data.Account)},function(){$log.error("API deleteProject error")})}}),app.service("Task",function($http,$log,$filter){this.fetchTasks=function(session,project_id,paging_size,paging_offset,condition_keywords,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks",params:{session:session,project_id:project_id,paging_size:paging_size,paging_offset:paging_offset,condition_keywords:condition_keywords}}).then(function(response){var date,rObj={},tomorrow=new Date;tomorrow.setDate(tomorrow.getDate()-1),response.data.tasks.forEach(function(item){var taskDate=new Date(item.Task.created_at);item.Task.date=$filter("date")(taskDate,"EEEE")+" ("+$filter("date")(taskDate,"dd.MM.yyyy")+")",$filter("date")(new Date,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")?item.Task.date="Today":$filter("date")(tomorrow,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")&&(item.Task.date="Yesterday"),null!=item.Task.title&&(item.Task.date==date?rObj[date].push(item.Task):(date=item.Task.date,rObj[date]=[item.Task]))}),callback({tasks:rObj,total_count:response.data.total_count})},function(){$log.error("API fetchTasks error")})},this.fetchTask=function(session,task_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:task_id}}).then(function(response){callback(response.data.Task)},function(){$log.error("API fetchProject error")})},this.createTask=function(session,project_id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Project:{id:project_id},Task:{title:title,description:description}}}).then(function(response){callback(response.data.Task)},function(){$log.error("API createTask error")})},this.updateTask=function(session,id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id,title:title,description:description}}}).then(function(response){callback(response.data)},function(){$log.error("API updateTask error")})},this.deleteTask=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:id}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})},this.compliteTask=function(session,id,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id}}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})}}),app.directive("projectsList",function(){return{restrict:"AE",templateUrl:"views/projects.tpl.html"}}),app.directive("whenScrolled",function(){return function(scope,elm,attr){var raw=elm[0];elm.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight&&scope.$apply(attr.whenScrolled)})}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibiIsImMiLCJsIiwiYiIsImEiLCJnIiwiZCIsImJhc2VIcmVmIiwiayIsImUiLCJmIiwiaCIsImV4cGlyZXMiLCJpc0RlZmluZWQiLCJwYXRoIiwiaXNVbmRlZmluZWQiLCJpc1N0cmluZyIsIkRhdGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJkb21haW4iLCJ0b1VUQ1N0cmluZyIsInNlY3VyZSIsImxlbmd0aCIsIndhcm4iLCJjb29raWUiLCJtb2R1bGUiLCJwcm92aWRlciIsInRoaXMiLCJkZWZhdWx0cyIsIiRnZXQiLCJnZXQiLCJnZXRPYmplY3QiLCJmcm9tSnNvbiIsImdldEFsbCIsInB1dCIsIm0iLCJleHRlbmQiLCJwdXRPYmplY3QiLCJ0b0pzb24iLCJyZW1vdmUiLCJmYWN0b3J5IiwiJGluamVjdCIsIndpbmRvdyIsImFuZ3VsYXIiLCJhcHAiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJG1kU2lkZW5hdiIsIiRjb29raWVzIiwiQWNjb3VudCIsIlByb2plY3QiLCJUYXNrIiwiZ2V0QWNjb3VudERhdGEiLCJmZXRjaEFjY291bnQiLCJkYXRhIiwiYWNjb3VudCIsImdldFByb2plY3RzIiwiZmV0Y2hQcm9qZWN0cyIsInByb2plY3RzIiwiZ2V0VGFza3MiLCJwcm9qZWN0IiwiaWQiLCJsb2FkaW5nIiwiY29udGVudCIsImZldGNoVGFza3MiLCJzaXplVGFzayIsInNlYXJjaCIsInRhc2tzIiwidG90YWxfY291bnQiLCJpc0FsbFRhc2tzIiwiY291bnRUYXNrIiwiYnVpbGRUb2dnbGVyIiwiY29tcG9uZW50SWQiLCJ0b2dnbGUiLCJzdGVwVGFzayIsImNyZWF0ZU5ld1VzZXIiLCJzZXNzaW9uIiwiY2hlY2tTZXNzaW9uIiwiJHdhdGNoIiwiYWRkUHJvamVjdEJhciIsIm5ld1Byb2plY3QiLCJ0b2dnbGVSaWdodCIsInJpZ2h0QmFyIiwic2hvd1Rhc2tCYXIiLCJ0YXNrSWQiLCJmZXRjaFRhc2siLCJ0YXNrIiwiZWRpdFByb2plY3RCYXIiLCJuZXdUaXRsZSIsInRpdGxlIiwiYWRkVGFza0JhciIsIm5ld1Rhc2siLCJlZGl0VGFza0JhciIsImFkZFByb2plY3QiLCJjcmVhdGVQcm9qZWN0IiwiZGVsZXRlUHJvamVjdCIsImVkaXRQcm9qZWN0IiwidXBkYXRlUHJvamVjdCIsImFkZFRhc2siLCJjcmVhdGVUYXNrIiwiZGVzY3JpcHRpb24iLCJlZGl0VGFzayIsInVwZGF0ZVRhc2siLCJkZWxldGVUYXNrIiwiY29tcGxpdGVUYXNrIiwibG9hZE1vcmVUYXNrcyIsIm9wZW5NZW51IiwiJG1kT3Blbk1lbnUiLCJldiIsIm9yaWdpbmF0b3JFdiIsInNlcnZpY2UiLCIkaHR0cCIsIiRsb2ciLCJjYWxsYmFjayIsIm1ldGhvZCIsInVybCIsInRoZW4iLCJyZXNwb25zZSIsImVycm9yIiwicGFyYW1zIiwiZmV0Y2hQcm9qZWN0IiwicHJvamVjdF9pZCIsIiRmaWx0ZXIiLCJwYWdpbmdfc2l6ZSIsInBhZ2luZ19vZmZzZXQiLCJjb25kaXRpb25fa2V5d29yZHMiLCJkYXRlIiwick9iaiIsInRvbW9ycm93Iiwic2V0RGF0ZSIsImdldERhdGUiLCJmb3JFYWNoIiwiaXRlbSIsInRhc2tEYXRlIiwiY3JlYXRlZF9hdCIsInB1c2giLCJ0YXNrX2lkIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZVVybCIsInNjb3BlIiwiZWxtIiwiYXR0ciIsInJhdyIsImJpbmQiLCJzY3JvbGxUb3AiLCJvZmZzZXRIZWlnaHQiLCJzY3JvbGxIZWlnaHQiLCIkYXBwbHkiLCJ3aGVuU2Nyb2xsZWQiXSwibWFwcGluZ3MiOiJDQVNBLFNBQVVBLEVBQUVDLEdBQUcsWUFBYSxTQUFTQyxHQUFFQyxFQUFFQyxFQUFFQyxHQUFHLEdBQUlDLEdBQUVELEVBQUVFLFdBQVdDLEVBQUVMLEVBQUUsRUFBRyxPQUFPLFVBQVNBLEVBQUVNLEVBQUVDLEdBQUcsR0FBSUwsR0FBRU0sQ0FBRUQsR0FBRUEsTUFBTUMsRUFBRUQsRUFBRUUsUUFBUVAsRUFB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UzVCLFFBQVNmLEdBQUlvRCxVQUN0Q0YsT0FDSUcsT0FBUSxPQUNSQyxJQUFLLGlEQUNMN0QsTUFBT3NCLFFBQVNBLFFBQVN6QixNQUFPVSxHQUFJQSxPQUNyQ3VELEtBQUssU0FBeUJDLFVBQzdCSixTQUFTSSxTQUFTL0QsT0FDbkIsV0FDQzBELEtBQUtNLE1BQU0sNkJBS3ZCMUUsSUFBSTZGLFVBQVUsZUFBZ0IsV0FDMUIsT0FDSUMsU0FBVSxLQUNWQyxZQUFhLDZCQUdyQi9GLElBQUk2RixVQUFVLGVBQWdCLFdBQzFCLE1BQU8sVUFBU0csTUFBT0MsSUFBS0MsTUFDeEIsR0FBSUMsS0FBTUYsSUFBSSxFQUVkQSxLQUFJRyxLQUFLLFNBQVUsV0FDWEQsSUFBSUUsVUFBWUYsSUFBSUcsY0FBZ0JILElBQUlJLGNBQ3hDUCxNQUFNUSxPQUFPTixLQUFLTyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IEpleGltIG9uIDE5LjEwLjE2LlxuICovXG5cbi8qXG4gQW5ndWxhckpTIHYxLjUuOFxuIChjKSAyMDEwLTIwMTYgR29vZ2xlLCBJbmMuIGh0dHA6Ly9hbmd1bGFyanMub3JnXG4gTGljZW5zZTogTUlUXG4qL1xuKGZ1bmN0aW9uKG4sYyl7J3VzZSBzdHJpY3QnO2Z1bmN0aW9uIGwoYixhLGcpe3ZhciBkPWcuYmFzZUhyZWYoKSxrPWJbMF07cmV0dXJuIGZ1bmN0aW9uKGIsZSxmKXt2YXIgZyxoO2Y9Znx8e307aD1mLmV4cGlyZXM7Zz1jLmlzRGVmaW5lZChmLnBhdGgpP2YucGF0aDpkO2MuaXNVbmRlZmluZWQoZSkmJihoPVwiVGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBHTVRcIixlPVwiXCIpO2MuaXNTdHJpbmcoaCkmJihoPW5ldyBEYXRlKGgpKTtlPWVuY29kZVVSSUNvbXBvbmVudChiKStcIj1cIitlbmNvZGVVUklDb21wb25lbnQoZSk7ZT1lKyhnP1wiO3BhdGg9XCIrZzpcIlwiKSsoZi5kb21haW4/XCI7ZG9tYWluPVwiK2YuZG9tYWluOlwiXCIpO2UrPWg/XCI7ZXhwaXJlcz1cIitoLnRvVVRDU3RyaW5nKCk6XCJcIjtlKz1mLnNlY3VyZT9cIjtzZWN1cmVcIjpcIlwiO2Y9ZS5sZW5ndGgrMTs0MDk2PGYmJmEud2FybihcIkNvb2tpZSAnXCIrYitcIicgcG9zc2libHkgbm90IHNldCBvciBvdmVyZmxvd2VkIGJlY2F1c2UgaXQgd2FzIHRvbyBsYXJnZSAoXCIrXG5mK1wiID4gNDA5NiBieXRlcykhXCIpO2suY29va2llPWV9fWMubW9kdWxlKFwibmdDb29raWVzXCIsW1wibmdcIl0pLnByb3ZpZGVyKFwiJGNvb2tpZXNcIixbZnVuY3Rpb24oKXt2YXIgYj10aGlzLmRlZmF1bHRzPXt9O3RoaXMuJGdldD1bXCIkJGNvb2tpZVJlYWRlclwiLFwiJCRjb29raWVXcml0ZXJcIixmdW5jdGlvbihhLGcpe3JldHVybntnZXQ6ZnVuY3Rpb24oZCl7cmV0dXJuIGEoKVtkXX0sZ2V0T2JqZWN0OmZ1bmN0aW9uKGQpe3JldHVybihkPXRoaXMuZ2V0KGQpKT9jLmZyb21Kc29uKGQpOmR9LGdldEFsbDpmdW5jdGlvbigpe3JldHVybiBhKCl9LHB1dDpmdW5jdGlvbihkLGEsbSl7ZyhkLGEsbT9jLmV4dGVuZCh7fSxiLG0pOmIpfSxwdXRPYmplY3Q6ZnVuY3Rpb24oZCxiLGEpe3RoaXMucHV0KGQsYy50b0pzb24oYiksYSl9LHJlbW92ZTpmdW5jdGlvbihhLGspe2coYSx2b2lkIDAsaz9jLmV4dGVuZCh7fSxiLGspOmIpfX19XX1dKTtjLm1vZHVsZShcIm5nQ29va2llc1wiKS5mYWN0b3J5KFwiJGNvb2tpZVN0b3JlXCIsXG5bXCIkY29va2llc1wiLGZ1bmN0aW9uKGIpe3JldHVybntnZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGIuZ2V0T2JqZWN0KGEpfSxwdXQ6ZnVuY3Rpb24oYSxjKXtiLnB1dE9iamVjdChhLGMpfSxyZW1vdmU6ZnVuY3Rpb24oYSl7Yi5yZW1vdmUoYSl9fX1dKTtsLiRpbmplY3Q9W1wiJGRvY3VtZW50XCIsXCIkbG9nXCIsXCIkYnJvd3NlclwiXTtjLm1vZHVsZShcIm5nQ29va2llc1wiKS5wcm92aWRlcihcIiQkY29va2llV3JpdGVyXCIsZnVuY3Rpb24oKXt0aGlzLiRnZXQ9bH0pfSkod2luZG93LHdpbmRvdy5hbmd1bGFyKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFuZ3VsYXItY29va2llcy5taW4uanMubWFwXG5cbi8qKlxuICogQ3JlYXRlZCBieSBKZXhpbSBvbiAxOS4xMC4xNi5cbiAqL1xuXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ1Rlc3RGcm9udGVuZCcsIFsnbmdNYXRlcmlhbCcsICduZ0Nvb2tpZXMnXSk7XG5cbmFwcC5jb250cm9sbGVyKCdNYWluQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRtZFNpZGVuYXYsICRjb29raWVzLCBBY2NvdW50LCBQcm9qZWN0LCBUYXNrKXtcblxuICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAkc2NvcGUuc3RlcFRhc2sgPSAzO1xuICAgICRzY29wZS5pc0FsbFRhc2tzID0gZmFsc2U7XG4gICAgJHNjb3BlLmNvdW50VGFzayA9IDA7XG4gICAgJHNjb3BlLnByb2plY3QgPSB7IGlkOiAwIH07XG5cbiAgICBpZih0eXBlb2YgJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpICE9ICdzdHJpbmcnKXtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBBY2NvdW50LmNyZWF0ZU5ld1VzZXIoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAkY29va2llcy5wdXQoJ3VzZXJTZXNzaW9uS2V5JywgZGF0YS5zZXNzaW9uKTtcbiAgICAgICAgICAgIGdldEFjY291bnREYXRhKCk7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBBY2NvdW50LmNoZWNrU2Vzc2lvbigkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGdldEFjY291bnREYXRhKCk7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgJHNjb3BlLiR3YXRjaCgncHJvamVjdC5pZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUuc2l6ZVRhc2sgPSAxMDtcbiAgICAgICAgJHNjb3BlLnNlYXJjaCA9IG51bGw7XG4gICAgICAgIGdldFRhc2tzKCk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJHdhdGNoKCdzZWFyY2gnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgZ2V0VGFza3MoKTtcbiAgICB9KTtcblxuICAgICRzY29wZS4kd2F0Y2goJ3Rhc2tzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZigkc2NvcGUucHJvamVjdC5pZCAhPSAwICYmICRzY29wZS5jb3VudFRhc2sgPT0gMCAmJiAhJHNjb3BlLnNlYXJjaCl7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy90YXNrc19kb25lLnRwbC5odG1sJztcbiAgICAgICAgfSBlbHNlIGlmKCRzY29wZS5jb3VudFRhc2sgPT0gMCAmJiAkc2NvcGUuc2VhcmNoKSB7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy90YXNrc19ub3QudHBsLmh0bWwnO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuYWRkUHJvamVjdEJhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkZWxldGUgJHNjb3BlLm5ld1Byb2plY3Q7XG4gICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvcHJvamVjdF9hZGQudHBsLmh0bWwnO1xuICAgIH07XG5cbiAgICAkc2NvcGUuc2hvd1Rhc2tCYXIgPSBmdW5jdGlvbih0YXNrSWQpIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLmZldGNoVGFzaygkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksIHRhc2tJZCwgZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAkc2NvcGUudGFzayA9IGRhdGE7XG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy90YXNrLnRwbC5odG1sJztcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZWRpdFByb2plY3RCYXIgID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAkc2NvcGUucHJvamVjdC5uZXdUaXRsZSA9ICRzY29wZS5wcm9qZWN0LnRpdGxlO1xuICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvcHJvamVjdF9lZGl0LnRwbC5odG1sJztcbiAgICB9O1xuXG5cbiAgICAkc2NvcGUuYWRkVGFza0JhciAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgZGVsZXRlICRzY29wZS5uZXdUYXNrO1xuICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgJHNjb3BlLnJpZ2h0QmFyID0gJ3ZpZXdzL3Rhc2tfYWRkLnRwbC5odG1sJztcbiAgICB9O1xuXG4gICAgJHNjb3BlLmVkaXRUYXNrQmFyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy90YXNrX2VkaXQudHBsLmh0bWwnO1xuICAgIH07XG5cbiAgICAkc2NvcGUuYWRkUHJvamVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFByb2plY3QuY3JlYXRlUHJvamVjdCgkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksICRzY29wZS5uZXdQcm9qZWN0LnRpdGxlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZGVsZXRlUHJvamVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFByb2plY3QuZGVsZXRlUHJvamVjdCgkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksICRzY29wZS5wcm9qZWN0LmlkLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3Mvc2VsZWN0X3Byb2plY3QudHBsLmh0bWwnO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmVkaXRQcm9qZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgUHJvamVjdC51cGRhdGVQcm9qZWN0KCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgJHNjb3BlLnByb2plY3QuaWQsICRzY29wZS5wcm9qZWN0Lm5ld1RpdGxlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgICRzY29wZS5wcm9qZWN0LnRpdGxlID0gJHNjb3BlLnByb2plY3QubmV3VGl0bGU7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG5cbiAgICAkc2NvcGUuYWRkVGFzayAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLmNyZWF0ZVRhc2soXG4gICAgICAgICAgICAkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksXG4gICAgICAgICAgICAkc2NvcGUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICRzY29wZS5uZXdUYXNrLnRpdGxlLFxuICAgICAgICAgICAgJHNjb3BlLm5ld1Rhc2suZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgICAgIGdldFRhc2tzKCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmVkaXRUYXNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgVGFzay51cGRhdGVUYXNrKFxuICAgICAgICAgICAgJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLFxuICAgICAgICAgICAgJHNjb3BlLnRhc2suaWQsXG4gICAgICAgICAgICAkc2NvcGUudGFzay50aXRsZSxcbiAgICAgICAgICAgICRzY29wZS50YXNrLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvdGFzay50cGwuaHRtbCc7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmRlbGV0ZVRhc2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLmRlbGV0ZVRhc2soJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCAkc2NvcGUudGFzay5pZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgIGdldFRhc2tzKCk7XG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuY29tcGxpdGVUYXNrID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLmNvbXBsaXRlVGFzaygkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksIGlkLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICBnZXRUYXNrcygpO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5sb2FkTW9yZVRhc2tzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZighJHNjb3BlLmlzQWxsVGFza3Mpe1xuICAgICAgICAgICAgJHNjb3BlLnNpemVUYXNrID0gJHNjb3BlLnNpemVUYXNrICsgJHNjb3BlLnN0ZXBUYXNrO1xuICAgICAgICAgICAgaWYoJHNjb3BlLnNpemVUYXNrID4gJHNjb3BlLmNvdW50VGFzaylcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZVRhc2sgPSAkc2NvcGUuY291bnRUYXNrO1xuICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUub3Blbk1lbnUgPSBmdW5jdGlvbigkbWRPcGVuTWVudSwgZXYpIHtcbiAgICAgICAgb3JpZ2luYXRvckV2ID0gZXY7XG4gICAgICAgICRtZE9wZW5NZW51KGV2KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnRvZ2dsZVJpZ2h0ID0gYnVpbGRUb2dnbGVyKCdyaWdodCcpO1xuXG4gICAgZnVuY3Rpb24gZ2V0QWNjb3VudERhdGEoKSB7XG4gICAgICAgIEFjY291bnQuZmV0Y2hBY2NvdW50KCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLmFjY291bnQgPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRQcm9qZWN0cygpIHtcbiAgICAgICAgUHJvamVjdC5mZXRjaFByb2plY3RzKCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLnByb2plY3RzID0gZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0VGFza3MoKSB7XG4gICAgICAgIGlmKCRzY29wZS5wcm9qZWN0LmlkICE9IDApe1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3MvdGFza3MudHBsLmh0bWwnO1xuICAgICAgICAgICAgVGFzay5mZXRjaFRhc2tzKFxuICAgICAgICAgICAgICAgICRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSxcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZVRhc2ssXG4gICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VhcmNoLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRhc2tzID0gZGF0YS50YXNrcztcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNpemVUYXNrID49IGRhdGEudG90YWxfY291bnQgPyAkc2NvcGUuaXNBbGxUYXNrcyA9IHRydWUgOiAkc2NvcGUuaXNBbGxUYXNrcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRUYXNrID0gZGF0YS50b3RhbF9jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3Mvc2VsZWN0X3Byb2plY3QudHBsLmh0bWwnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYnVpbGRUb2dnbGVyKGNvbXBvbmVudElkKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtZFNpZGVuYXYoY29tcG9uZW50SWQpLnRvZ2dsZSgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5hcHAuc2VydmljZSgnQWNjb3VudCcsIGZ1bmN0aW9uKCRodHRwLCAkbG9nKSB7XG5cbiAgICB0aGlzLmNyZWF0ZU5ld1VzZXIgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3NpZ251cCdcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGNyZWF0ZU5ld1VzZXIgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHRoaXMuY2hlY2tTZXNzaW9uID0gZnVuY3Rpb24gKHNlc3Npb24gLGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9zZXNzaW9uJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb259LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGNoZWNrU2Vzc2lvbiBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdGhpcy5mZXRjaEFjY291bnQgPSBmdW5jdGlvbihzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vYWNjb3VudCcsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9ufSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuQWNjb3VudCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hBY2NvdW50IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuYXBwLnNlcnZpY2UoJ1Byb2plY3QnLCBmdW5jdGlvbigkaHR0cCwgJGxvZykge1xuXG4gICAgdGhpcy5mZXRjaFByb2plY3RzID0gZnVuY3Rpb24oc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Byb2plY3RzJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb259LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5wcm9qZWN0cyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hQcm9qZWN0cyBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5mZXRjaFByb2plY3QgPSBmdW5jdGlvbiAoc2Vzc2lvbiAsIHByb2plY3RfaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cy9wcm9qZWN0JyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb24sIHByb2plY3RfaWQ6IHByb2plY3RfaWR9LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGZldGNoUHJvamVjdCBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5jcmVhdGVQcm9qZWN0ID0gZnVuY3Rpb24oc2Vzc2lvbiwgdGl0bGUsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vcHJvamVjdHMvcHJvamVjdCcsXG4gICAgICAgICAgICBkYXRhOiB7c2Vzc2lvbjogc2Vzc2lvbiwgUHJvamVjdDogeyB0aXRsZTogdGl0bGUgfX0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLkFjY291bnQpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGNyZWF0ZVByb2plY3QgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMudXBkYXRlUHJvamVjdCA9IGZ1bmN0aW9uKHNlc3Npb24sIGlkLCB0aXRsZSwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cy9wcm9qZWN0JyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBQcm9qZWN0OiB7IGlkOiBpZCwgdGl0bGU6IHRpdGxlIH19LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5BY2NvdW50KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSB1cGRhdGVQcm9qZWN0IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmRlbGV0ZVByb2plY3QgPSBmdW5jdGlvbihzZXNzaW9uLCBpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Byb2plY3RzL3Byb2plY3QnLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbiwgcHJvamVjdF9pZDogaWR9LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5BY2NvdW50KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBkZWxldGVQcm9qZWN0IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuYXBwLnNlcnZpY2UoJ1Rhc2snLCBmdW5jdGlvbigkaHR0cCwgJGxvZywgJGZpbHRlcikge1xuXG4gICAgdGhpcy5mZXRjaFRhc2tzID0gZnVuY3Rpb24oc2Vzc2lvbiwgcHJvamVjdF9pZCwgcGFnaW5nX3NpemUsIHBhZ2luZ19vZmZzZXQsIGNvbmRpdGlvbl9rZXl3b3JkcywgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb24sIHByb2plY3RfaWQ6IHByb2plY3RfaWQsIHBhZ2luZ19zaXplOiBwYWdpbmdfc2l6ZSwgcGFnaW5nX29mZnNldDogcGFnaW5nX29mZnNldCwgY29uZGl0aW9uX2tleXdvcmRzOiBjb25kaXRpb25fa2V5d29yZHN9LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGRhdGU7XG4gICAgICAgICAgICB2YXIgck9iaiA9IHt9O1xuICAgICAgICAgICAgdmFyIHRvbW9ycm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIHRvbW9ycm93LnNldERhdGUodG9tb3Jyb3cuZ2V0RGF0ZSgpIC0gMSk7XG5cbiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEudGFza3MuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgICAgICAgICB2YXIgdGFza0RhdGUgPSBuZXcgRGF0ZShpdGVtLlRhc2suY3JlYXRlZF9hdCk7XG5cbiAgICAgICAgICAgICAgICBpdGVtLlRhc2suZGF0ZSA9ICRmaWx0ZXIoJ2RhdGUnKSh0YXNrRGF0ZSwgJ0VFRUUnKSArICcgKCcgKyAkZmlsdGVyKCdkYXRlJykodGFza0RhdGUsICdkZC5NTS55eXl5JykgKyAnKSc7XG5cbiAgICAgICAgICAgICAgICBpZigkZmlsdGVyKCdkYXRlJykobmV3IERhdGUoKSwgJ2RkLk1NLnl5eXknKSA9PSAkZmlsdGVyKCdkYXRlJykodGFza0RhdGUsICdkZC5NTS55eXl5JykpXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uVGFzay5kYXRlID0gXCJUb2RheVwiO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYoJGZpbHRlcignZGF0ZScpKHRvbW9ycm93LCAnZGQuTU0ueXl5eScpID09ICRmaWx0ZXIoJ2RhdGUnKSh0YXNrRGF0ZSwgJ2RkLk1NLnl5eXknKSlcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5UYXNrLmRhdGUgPSBcIlllc3RlcmRheVwiO1xuXG4gICAgICAgICAgICAgICAgaWYoaXRlbS5UYXNrLnRpdGxlICE9IG51bGwpe1xuICAgICAgICAgICAgICAgICAgICBpZihpdGVtLlRhc2suZGF0ZSA9PSBkYXRlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJPYmpbZGF0ZV0ucHVzaChpdGVtLlRhc2spO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGl0ZW0uVGFzay5kYXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgck9ialtkYXRlXSA9IFtpdGVtLlRhc2tdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgdGFza3M6IHJPYmosXG4gICAgICAgICAgICAgICAgdG90YWxfY291bnQ6IHJlc3BvbnNlLmRhdGEudG90YWxfY291bnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGZldGNoVGFza3MgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuZmV0Y2hUYXNrID0gZnVuY3Rpb24gKHNlc3Npb24gLCB0YXNrX2lkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9uLCB0YXNrX2lkOiB0YXNrX2lkfSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuVGFzayk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hQcm9qZWN0IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmNyZWF0ZVRhc2sgPSBmdW5jdGlvbihzZXNzaW9uLCBwcm9qZWN0X2lkLCB0aXRsZSwgZGVzY3JpcHRpb24sIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBkYXRhOiB7c2Vzc2lvbjogc2Vzc2lvbiwgUHJvamVjdDoge2lkOiBwcm9qZWN0X2lkfSwgVGFzazoge3RpdGxlOiB0aXRsZSwgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9ufX0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLlRhc2spO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGNyZWF0ZVRhc2sgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMudXBkYXRlVGFzayA9IGZ1bmN0aW9uKHNlc3Npb24sIGlkLCB0aXRsZSwgZGVzY3JpcHRpb24sIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBkYXRhOiB7c2Vzc2lvbjogc2Vzc2lvbiwgVGFzazoge2lkOiBpZCwgdGl0bGU6IHRpdGxlLCBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb259fSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIHVwZGF0ZVRhc2sgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVsZXRlVGFzayA9IGZ1bmN0aW9uKHNlc3Npb24sIGlkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9uLCB0YXNrX2lkOiBpZH0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBkZWxldGVUYXNrIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuY29tcGxpdGVUYXNrID0gZnVuY3Rpb24oc2Vzc2lvbiwgaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBkYXRhOiB7c2Vzc2lvbjogc2Vzc2lvbiwgVGFzazoge2lkOiBpZH19LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZGVsZXRlVGFzayBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxuYXBwLmRpcmVjdGl2ZSgncHJvamVjdHNMaXN0JywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiQUVcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvcHJvamVjdHMudHBsLmh0bWxcIlxuICAgIH1cbn0pO1xuYXBwLmRpcmVjdGl2ZSgnd2hlblNjcm9sbGVkJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbG0sIGF0dHIpIHtcbiAgICAgICAgdmFyIHJhdyA9IGVsbVswXTtcblxuICAgICAgICBlbG0uYmluZCgnc2Nyb2xsJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAocmF3LnNjcm9sbFRvcCArIHJhdy5vZmZzZXRIZWlnaHQgPj0gcmF3LnNjcm9sbEhlaWdodCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShhdHRyLndoZW5TY3JvbGxlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG59KTsiXX0=
