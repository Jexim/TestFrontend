!function(n,c){"use strict";function l(b,a,g){var d=g.baseHref(),k=b[0];return function(b,e,f){var g,h;f=f||{},h=f.expires,g=c.isDefined(f.path)?f.path:d,c.isUndefined(e)&&(h="Thu, 01 Jan 1970 00:00:00 GMT",e=""),c.isString(h)&&(h=new Date(h)),e=encodeURIComponent(b)+"="+encodeURIComponent(e),e=e+(g?";path="+g:"")+(f.domain?";domain="+f.domain:""),e+=h?";expires="+h.toUTCString():"",e+=f.secure?";secure":"",f=e.length+1,4096<f&&a.warn("Cookie '"+b+"' possibly not set or overflowed because it was too large ("+f+" > 4096 bytes)!"),k.cookie=e}}c.module("ngCookies",["ng"]).provider("$cookies",[function(){var b=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function(a,g){return{get:function(d){return a()[d]},getObject:function(d){return(d=this.get(d))?c.fromJson(d):d},getAll:function(){return a()},put:function(d,a,m){g(d,a,m?c.extend({},b,m):b)},putObject:function(d,b,a){this.put(d,c.toJson(b),a)},remove:function(a,k){g(a,void 0,k?c.extend({},b,k):b)}}}]}]),c.module("ngCookies").factory("$cookieStore",["$cookies",function(b){return{get:function(a){return b.getObject(a)},put:function(a,c){b.putObject(a,c)},remove:function(a){b.remove(a)}}}]),l.$inject=["$document","$log","$browser"],c.module("ngCookies").provider("$$cookieWriter",function(){this.$get=l})}(window,window.angular);var app=angular.module("TestFrontend",["ngMaterial","ngCookies"]);app.controller("MainCtrl",function($scope,$mdSidenav,$cookies,Account,Project,Task){function getAccountData(){Account.fetchAccount($cookies.get("userSessionKey"),function(data){$scope.account=data})}function getProjects(){Project.fetchProjects($cookies.get("userSessionKey"),function(data){$scope.projects=data})}function getTasks(){0!=$scope.project.id?($scope.content="views/tasks.tpl.html",Task.fetchTasks($cookies.get("userSessionKey"),$scope.project.id,$scope.sizeTask,0,$scope.search,function(data){$scope.tasks=data.tasks,$scope.sizeTask>=data.total_count?$scope.isAllTasks=!0:$scope.isAllTasks=!1,$scope.countTask=data.total_count})):$scope.content="views/select_project.tpl.html"}function buildToggler(componentId){return function(){$mdSidenav(componentId).toggle()}}$scope.loading=!0,$scope.stepTask=3,$scope.countTask=0,$scope.project={id:0},"string"!=typeof $cookies.get("userSessionKey")?($scope.loading=!0,Account.createNewUser(function(data){$cookies.put("userSessionKey",data.session),getAccountData(),getProjects(),$scope.loading=!1})):($scope.loading=!0,Account.checkSession($cookies.get("userSessionKey"),function(){$scope.loading=!1,getAccountData(),getProjects(),$scope.loading=!1})),$scope.$watch("project.id",function(){$scope.sizeTask=13,$scope.search=null,getTasks()}),$scope.$watch("tasks",function(){0==$scope.project.id||0!=$scope.countTask||$scope.search?0==$scope.countTask&&$scope.search&&($scope.content="views/tasks_not.tpl.html"):$scope.content="views/tasks_done.tpl.html"}),$scope.$watch("search",function(){void 0==$scope.search&&getTasks()}),$scope.searchTasks=function(){getTasks()},$scope.addProjectBar=function(){delete $scope.newProject,$scope.toggleRight(),$scope.rightBar="views/project_add.tpl.html"},$scope.showTaskBar=function(taskId){Task.fetchTask($cookies.get("userSessionKey"),taskId,function(data){$scope.task=data,$scope.toggleRight(),$scope.rightBar="views/task.tpl.html"})},$scope.editProjectBar=function(){$scope.toggleRight(),$scope.project.newTitle=$scope.project.title,$scope.rightBar="views/project_edit.tpl.html"},$scope.addTaskBar=function(){delete $scope.newTask,$scope.toggleRight(),$scope.rightBar="views/task_add.tpl.html"},$scope.editTaskBar=function(){$scope.rightBar="views/task_edit.tpl.html"},$scope.addProject=function(){Project.createProject($cookies.get("userSessionKey"),$scope.newProject.title,function(){getProjects(),$scope.toggleRight()})},$scope.deleteProject=function(){Project.deleteProject($cookies.get("userSessionKey"),$scope.project.id,function(){getProjects(),delete $scope.project,$scope.content="views/select_project.tpl.html"})},$scope.editProject=function(){Project.updateProject($cookies.get("userSessionKey"),$scope.project.id,$scope.project.newTitle,function(){getProjects(),$scope.toggleRight(),$scope.project.title=$scope.project.newTitle})},$scope.addTask=function(){Task.createTask($cookies.get("userSessionKey"),$scope.project.id,$scope.newTask.title,$scope.newTask.description,function(){getProjects(),getTasks(),$scope.toggleRight()})},$scope.editTask=function(){Task.updateTask($cookies.get("userSessionKey"),$scope.task.id,$scope.task.title,$scope.task.description,function(){getTasks(),$scope.rightBar="views/task.tpl.html"})},$scope.deleteTask=function(){Task.deleteTask($cookies.get("userSessionKey"),$scope.task.id,function(){getProjects(),getTasks(),$scope.toggleRight()})},$scope.compliteTask=function(id){Task.compliteTask($cookies.get("userSessionKey"),id,function(){getProjects(),getTasks()})},$scope.loadMoreTasks=function(){$scope.isAllTasks||($scope.sizeTask=$scope.sizeTask+$scope.stepTask,$scope.sizeTask>$scope.countTask&&($scope.sizeTask=$scope.countTask),getTasks())},$scope.openMenu=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},$scope.toggleRight=buildToggler("right")}),app.service("Account",function($http,$log){this.createNewUser=function(callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/signup"}).then(function(response){callback(response.data)},function(){$log.error("API createNewUser error")})},this.checkSession=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/session",params:{session:session}}).then(function(response){callback(response)},function(){$log.error("API checkSession error")})},this.fetchAccount=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/account",params:{session:session}}).then(function(response){callback(response.data.Account)},function(){$log.error("API fetchAccount error")})}}),app.service("Project",function($http,$log){this.fetchProjects=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects",params:{session:session}}).then(function(response){callback(response.data.projects)},function(){$log.error("API fetchProjects error")})},this.fetchProject=function(session,project_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:project_id}}).then(function(response){callback(response)},function(){$log.error("API fetchProject error")})},this.createProject=function(session,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API createProject error")})},this.updateProject=function(session,id,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{id:id,title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API updateProject error")})},this.deleteProject=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:id}}).then(function(response){callback(response.data.Account)},function(){$log.error("API deleteProject error")})}}),app.service("Task",function($http,$log,$filter){this.fetchTasks=function(session,project_id,paging_size,paging_offset,condition_keywords,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks",params:{session:session,project_id:project_id,paging_size:paging_size,paging_offset:paging_offset,condition_keywords:condition_keywords}}).then(function(response){var date,rObj={},tomorrow=new Date;tomorrow.setDate(tomorrow.getDate()-1),response.data.tasks.forEach(function(item){var taskDate=new Date(item.Task.created_at);item.Task.date=$filter("date")(taskDate,"EEEE")+" ("+$filter("date")(taskDate,"dd.MM.yyyy")+")",$filter("date")(new Date,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")?item.Task.date="Today":$filter("date")(tomorrow,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")&&(item.Task.date="Yesterday"),null!=item.Task.title&&(item.Task.date==date?rObj[date].push(item.Task):(date=item.Task.date,rObj[date]=[item.Task]))}),callback({tasks:rObj,total_count:response.data.total_count})},function(){$log.error("API fetchTasks error")})},this.fetchTask=function(session,task_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:task_id}}).then(function(response){callback(response.data.Task)},function(){$log.error("API fetchProject error")})},this.createTask=function(session,project_id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Project:{id:project_id},Task:{title:title,description:description}}}).then(function(response){callback(response.data.Task)},function(){$log.error("API createTask error")})},this.updateTask=function(session,id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id,title:title,description:description}}}).then(function(response){callback(response.data)},function(){$log.error("API updateTask error")})},this.deleteTask=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:id}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})},this.compliteTask=function(session,id,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id}}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})}}),app.directive("projectsList",function(){return{restrict:"AE",templateUrl:"views/projects.tpl.html"}}),app.directive("whenScrolled",function(){return function(scope,elm,attr){var raw=elm[0];elm.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight&&scope.$apply(attr.whenScrolled)})}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibiIsImMiLCJsIiwiYiIsImEiLCJnIiwiZCIsImJhc2VIcmVmIiwiayIsImUiLCJmIiwiaCIsImV4cGlyZXMiLCJpc0RlZmluZWQiLCJwYXRoIiwiaXNVbmRlZmluZWQiLCJpc1N0cmluZyIsIkRhdGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJkb21haW4iLCJ0b1VUQ1N0cmluZyIsInNlY3VyZSIsImxlbmd0aCIsIndhcm4iLCJjb29raWUiLCJtb2R1bGUiLCJwcm92aWRlciIsInRoaXMiLCJkZWZhdWx0cyIsIiRnZXQiLCJnZXQiLCJnZXRPYmplY3QiLCJmcm9tSnNvbiIsImdldEFsbCIsInB1dCIsIm0iLCJleHRlbmQiLCJwdXRPYmplY3QiLCJ0b0pzb24iLCJyZW1vdmUiLCJmYWN0b3J5IiwiJGluamVjdCIsIndpbmRvdyIsImFuZ3VsYXIiLCJhcHAiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJG1kU2lkZW5hdiIsIiRjb29raWVzIiwiQWNjb3VudCIsIlByb2plY3QiLCJUYXNrIiwiZ2V0QWNjb3VudERhdGEiLCJmZXRjaEFjY291bnQiLCJkYXRhIiwiYWNjb3VudCIsImdldFByb2plY3RzIiwiZmV0Y2hQcm9qZWN0cyIsInByb2plY3RzIiwiZ2V0VGFza3MiLCJwcm9qZWN0IiwiaWQiLCJjb250ZW50IiwiZmV0Y2hUYXNrcyIsInNpemVUYXNrIiwic2VhcmNoIiwidGFza3MiLCJ0b3RhbF9jb3VudCIsImlzQWxsVGFza3MiLCJjb3VudFRhc2siLCJidWlsZFRvZ2dsZXIiLCJjb21wb25lbnRJZCIsInRvZ2dsZSIsImxvYWRpbmciLCJzdGVwVGFzayIsImNyZWF0ZU5ld1VzZXIiLCJzZXNzaW9uIiwiY2hlY2tTZXNzaW9uIiwiJHdhdGNoIiwidW5kZWZpbmVkIiwic2VhcmNoVGFza3MiLCJhZGRQcm9qZWN0QmFyIiwibmV3UHJvamVjdCIsInRvZ2dsZVJpZ2h0IiwicmlnaHRCYXIiLCJzaG93VGFza0JhciIsInRhc2tJZCIsImZldGNoVGFzayIsInRhc2siLCJlZGl0UHJvamVjdEJhciIsIm5ld1RpdGxlIiwidGl0bGUiLCJhZGRUYXNrQmFyIiwibmV3VGFzayIsImVkaXRUYXNrQmFyIiwiYWRkUHJvamVjdCIsImNyZWF0ZVByb2plY3QiLCJkZWxldGVQcm9qZWN0IiwiZWRpdFByb2plY3QiLCJ1cGRhdGVQcm9qZWN0IiwiYWRkVGFzayIsImNyZWF0ZVRhc2siLCJkZXNjcmlwdGlvbiIsImVkaXRUYXNrIiwidXBkYXRlVGFzayIsImRlbGV0ZVRhc2siLCJjb21wbGl0ZVRhc2siLCJsb2FkTW9yZVRhc2tzIiwib3Blbk1lbnUiLCIkbWRPcGVuTWVudSIsImV2Iiwib3JpZ2luYXRvckV2Iiwic2VydmljZSIsIiRodHRwIiwiJGxvZyIsImNhbGxiYWNrIiwibWV0aG9kIiwidXJsIiwidGhlbiIsInJlc3BvbnNlIiwiZXJyb3IiLCJwYXJhbXMiLCJmZXRjaFByb2plY3QiLCJwcm9qZWN0X2lkIiwiJGZpbHRlciIsInBhZ2luZ19zaXplIiwicGFnaW5nX29mZnNldCIsImNvbmRpdGlvbl9rZXl3b3JkcyIsImRhdGUiLCJyT2JqIiwidG9tb3Jyb3ciLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImZvckVhY2giLCJpdGVtIiwidGFza0RhdGUiLCJjcmVhdGVkX2F0IiwicHVzaCIsInRhc2tfaWQiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInRlbXBsYXRlVXJsIiwic2NvcGUiLCJlbG0iLCJhdHRyIiwicmF3IiwiYmluZCIsInNjcm9sbFRvcCIsIm9mZnNldEhlaWdodCIsInNjcm9sbEhlaWdodCIsIiRhcHBseSIsIndoZW5TY3JvbGxlZCJdLCJtYXBwaW5ncyI6IkNBU0EsU0FBVUEsRUFBRUMsR0FBRyxZQUFhLFNBQVNDLEdBQUVDLEVBQUVDLEVBQUVDLEdBQUcsR0FBSUMsR0FBRUQsRUFBRUUsV0FBV0MsRUFBRUwsRUFBRSxFQUFHLE9BQU8sVUFBU0EsRUFBRU0sRUFBRUMsR0FBRyxHQUFJTCxHQUFFTSxDQUFFRCxHQUFFQSxN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LEVBRWRBLEtBQUlHLEtBQUssU0FBVSxXQUNYRCxJQUFJRSxVQUFZRixJQUFJRyxjQUFnQkgsSUFBSUksY0FDeENQLE1BQU1RLE9BQU9OLEtBQUtPIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgSmV4aW0gb24gMTkuMTAuMTYuXG4gKi9cblxuLypcbiBBbmd1bGFySlMgdjEuNS44XG4gKGMpIDIwMTAtMjAxNiBHb29nbGUsIEluYy4gaHR0cDovL2FuZ3VsYXJqcy5vcmdcbiBMaWNlbnNlOiBNSVRcbiovXG4oZnVuY3Rpb24obixjKXsndXNlIHN0cmljdCc7ZnVuY3Rpb24gbChiLGEsZyl7dmFyIGQ9Zy5iYXNlSHJlZigpLGs9YlswXTtyZXR1cm4gZnVuY3Rpb24oYixlLGYpe3ZhciBnLGg7Zj1mfHx7fTtoPWYuZXhwaXJlcztnPWMuaXNEZWZpbmVkKGYucGF0aCk/Zi5wYXRoOmQ7Yy5pc1VuZGVmaW5lZChlKSYmKGg9XCJUaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVFwiLGU9XCJcIik7Yy5pc1N0cmluZyhoKSYmKGg9bmV3IERhdGUoaCkpO2U9ZW5jb2RlVVJJQ29tcG9uZW50KGIpK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudChlKTtlPWUrKGc/XCI7cGF0aD1cIitnOlwiXCIpKyhmLmRvbWFpbj9cIjtkb21haW49XCIrZi5kb21haW46XCJcIik7ZSs9aD9cIjtleHBpcmVzPVwiK2gudG9VVENTdHJpbmcoKTpcIlwiO2UrPWYuc2VjdXJlP1wiO3NlY3VyZVwiOlwiXCI7Zj1lLmxlbmd0aCsxOzQwOTY8ZiYmYS53YXJuKFwiQ29va2llICdcIitiK1wiJyBwb3NzaWJseSBub3Qgc2V0IG9yIG92ZXJmbG93ZWQgYmVjYXVzZSBpdCB3YXMgdG9vIGxhcmdlIChcIitcbmYrXCIgPiA0MDk2IGJ5dGVzKSFcIik7ay5jb29raWU9ZX19Yy5tb2R1bGUoXCJuZ0Nvb2tpZXNcIixbXCJuZ1wiXSkucHJvdmlkZXIoXCIkY29va2llc1wiLFtmdW5jdGlvbigpe3ZhciBiPXRoaXMuZGVmYXVsdHM9e307dGhpcy4kZ2V0PVtcIiQkY29va2llUmVhZGVyXCIsXCIkJGNvb2tpZVdyaXRlclwiLGZ1bmN0aW9uKGEsZyl7cmV0dXJue2dldDpmdW5jdGlvbihkKXtyZXR1cm4gYSgpW2RdfSxnZXRPYmplY3Q6ZnVuY3Rpb24oZCl7cmV0dXJuKGQ9dGhpcy5nZXQoZCkpP2MuZnJvbUpzb24oZCk6ZH0sZ2V0QWxsOmZ1bmN0aW9uKCl7cmV0dXJuIGEoKX0scHV0OmZ1bmN0aW9uKGQsYSxtKXtnKGQsYSxtP2MuZXh0ZW5kKHt9LGIsbSk6Yil9LHB1dE9iamVjdDpmdW5jdGlvbihkLGIsYSl7dGhpcy5wdXQoZCxjLnRvSnNvbihiKSxhKX0scmVtb3ZlOmZ1bmN0aW9uKGEsayl7ZyhhLHZvaWQgMCxrP2MuZXh0ZW5kKHt9LGIsayk6Yil9fX1dfV0pO2MubW9kdWxlKFwibmdDb29raWVzXCIpLmZhY3RvcnkoXCIkY29va2llU3RvcmVcIixcbltcIiRjb29raWVzXCIsZnVuY3Rpb24oYil7cmV0dXJue2dldDpmdW5jdGlvbihhKXtyZXR1cm4gYi5nZXRPYmplY3QoYSl9LHB1dDpmdW5jdGlvbihhLGMpe2IucHV0T2JqZWN0KGEsYyl9LHJlbW92ZTpmdW5jdGlvbihhKXtiLnJlbW92ZShhKX19fV0pO2wuJGluamVjdD1bXCIkZG9jdW1lbnRcIixcIiRsb2dcIixcIiRicm93c2VyXCJdO2MubW9kdWxlKFwibmdDb29raWVzXCIpLnByb3ZpZGVyKFwiJCRjb29raWVXcml0ZXJcIixmdW5jdGlvbigpe3RoaXMuJGdldD1sfSl9KSh3aW5kb3csd2luZG93LmFuZ3VsYXIpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YW5ndWxhci1jb29raWVzLm1pbi5qcy5tYXBcblxuLyoqXG4gKiBDcmVhdGVkIGJ5IEpleGltIG9uIDE5LjEwLjE2LlxuICovXG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnVGVzdEZyb250ZW5kJywgWyduZ01hdGVyaWFsJywgJ25nQ29va2llcyddKTtcblxuYXBwLmNvbnRyb2xsZXIoJ01haW5DdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgJG1kU2lkZW5hdiwgJGNvb2tpZXMsIEFjY291bnQsIFByb2plY3QsIFRhc2spe1xuXG4gICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICRzY29wZS5zdGVwVGFzayA9IDM7XG4gICAgJHNjb3BlLmNvdW50VGFzayA9IDA7XG4gICAgJHNjb3BlLnByb2plY3QgPSB7IGlkOiAwIH07XG5cbiAgICBpZih0eXBlb2YgJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpICE9ICdzdHJpbmcnKXtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBBY2NvdW50LmNyZWF0ZU5ld1VzZXIoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAkY29va2llcy5wdXQoJ3VzZXJTZXNzaW9uS2V5JywgZGF0YS5zZXNzaW9uKTtcbiAgICAgICAgICAgIGdldEFjY291bnREYXRhKCk7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBBY2NvdW50LmNoZWNrU2Vzc2lvbigkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGdldEFjY291bnREYXRhKCk7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgJHNjb3BlLiR3YXRjaCgncHJvamVjdC5pZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUuc2l6ZVRhc2sgPSAxMztcbiAgICAgICAgJHNjb3BlLnNlYXJjaCA9IG51bGw7XG4gICAgICAgIGdldFRhc2tzKCk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJHdhdGNoKCd0YXNrcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYoJHNjb3BlLnByb2plY3QuaWQgIT0gMCAmJiAkc2NvcGUuY291bnRUYXNrID09IDAgJiYgISRzY29wZS5zZWFyY2gpe1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3MvdGFza3NfZG9uZS50cGwuaHRtbCc7XG4gICAgICAgIH0gZWxzZSBpZigkc2NvcGUuY291bnRUYXNrID09IDAgJiYgJHNjb3BlLnNlYXJjaCkge1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3MvdGFza3Nfbm90LnRwbC5odG1sJztcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgJHNjb3BlLiR3YXRjaCgnc2VhcmNoJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKCRzY29wZS5zZWFyY2ggPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICB9KTtcblxuICAgICRzY29wZS5zZWFyY2hUYXNrcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBnZXRUYXNrcygpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuYWRkUHJvamVjdEJhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkZWxldGUgJHNjb3BlLm5ld1Byb2plY3Q7XG4gICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvcHJvamVjdF9hZGQudHBsLmh0bWwnO1xuICAgIH07XG5cbiAgICAkc2NvcGUuc2hvd1Rhc2tCYXIgPSBmdW5jdGlvbih0YXNrSWQpIHtcbiAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFRhc2suZmV0Y2hUYXNrKCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgdGFza0lkLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICRzY29wZS50YXNrID0gZGF0YTtcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAgICAgJHNjb3BlLnJpZ2h0QmFyID0gJ3ZpZXdzL3Rhc2sudHBsLmh0bWwnO1xuICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmVkaXRQcm9qZWN0QmFyICA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgJHNjb3BlLnByb2plY3QubmV3VGl0bGUgPSAkc2NvcGUucHJvamVjdC50aXRsZTtcbiAgICAgICAgJHNjb3BlLnJpZ2h0QmFyID0gJ3ZpZXdzL3Byb2plY3RfZWRpdC50cGwuaHRtbCc7XG4gICAgfTtcblxuXG4gICAgJHNjb3BlLmFkZFRhc2tCYXIgID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGRlbGV0ZSAkc2NvcGUubmV3VGFzaztcbiAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy90YXNrX2FkZC50cGwuaHRtbCc7XG4gICAgfTtcblxuICAgICRzY29wZS5lZGl0VGFza0JhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvdGFza19lZGl0LnRwbC5odG1sJztcbiAgICB9O1xuXG4gICAgJHNjb3BlLmFkZFByb2plY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFByb2plY3QuY3JlYXRlUHJvamVjdCgkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksICRzY29wZS5uZXdQcm9qZWN0LnRpdGxlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5kZWxldGVQcm9qZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBQcm9qZWN0LmRlbGV0ZVByb2plY3QoJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCAkc2NvcGUucHJvamVjdC5pZCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgZGVsZXRlICRzY29wZS5wcm9qZWN0O1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3Mvc2VsZWN0X3Byb2plY3QudHBsLmh0bWwnO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmVkaXRQcm9qZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBQcm9qZWN0LnVwZGF0ZVByb2plY3QoJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCAkc2NvcGUucHJvamVjdC5pZCwgJHNjb3BlLnByb2plY3QubmV3VGl0bGUsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAgICAgJHNjb3BlLnByb2plY3QudGl0bGUgPSAkc2NvcGUucHJvamVjdC5uZXdUaXRsZTtcbiAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuXG4gICAgJHNjb3BlLmFkZFRhc2sgID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLmNyZWF0ZVRhc2soXG4gICAgICAgICAgICAkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksXG4gICAgICAgICAgICAkc2NvcGUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICRzY29wZS5uZXdUYXNrLnRpdGxlLFxuICAgICAgICAgICAgJHNjb3BlLm5ld1Rhc2suZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgICAgIGdldFRhc2tzKCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZWRpdFRhc2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFRhc2sudXBkYXRlVGFzayhcbiAgICAgICAgICAgICRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSxcbiAgICAgICAgICAgICRzY29wZS50YXNrLmlkLFxuICAgICAgICAgICAgJHNjb3BlLnRhc2sudGl0bGUsXG4gICAgICAgICAgICAkc2NvcGUudGFzay5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGdldFRhc2tzKCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJpZ2h0QmFyID0gJ3ZpZXdzL3Rhc2sudHBsLmh0bWwnO1xuICAgICAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmRlbGV0ZVRhc2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFRhc2suZGVsZXRlVGFzaygkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksICRzY29wZS50YXNrLmlkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmNvbXBsaXRlVGFzayA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLmNvbXBsaXRlVGFzaygkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksIGlkLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICBnZXRUYXNrcygpO1xuICAgICAgICAgICAgLy8kc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmxvYWRNb3JlVGFza3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmKCEkc2NvcGUuaXNBbGxUYXNrcyl7XG4gICAgICAgICAgICAkc2NvcGUuc2l6ZVRhc2sgPSAkc2NvcGUuc2l6ZVRhc2sgKyAkc2NvcGUuc3RlcFRhc2s7XG4gICAgICAgICAgICBpZigkc2NvcGUuc2l6ZVRhc2sgPiAkc2NvcGUuY291bnRUYXNrKVxuICAgICAgICAgICAgICAgICRzY29wZS5zaXplVGFzayA9ICRzY29wZS5jb3VudFRhc2s7XG4gICAgICAgICAgICBnZXRUYXNrcygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5vcGVuTWVudSA9IGZ1bmN0aW9uKCRtZE9wZW5NZW51LCBldikge1xuICAgICAgICBvcmlnaW5hdG9yRXYgPSBldjtcbiAgICAgICAgJG1kT3Blbk1lbnUoZXYpO1xuICAgIH07XG5cbiAgICAkc2NvcGUudG9nZ2xlUmlnaHQgPSBidWlsZFRvZ2dsZXIoJ3JpZ2h0Jyk7XG5cbiAgICBmdW5jdGlvbiBnZXRBY2NvdW50RGF0YSgpIHtcbiAgICAgICAgQWNjb3VudC5mZXRjaEFjY291bnQoJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAkc2NvcGUuYWNjb3VudCA9IGRhdGE7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFByb2plY3RzKCkge1xuICAgICAgICBQcm9qZWN0LmZldGNoUHJvamVjdHMoJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAkc2NvcGUucHJvamVjdHMgPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRUYXNrcygpIHtcbiAgICAgICAgaWYoJHNjb3BlLnByb2plY3QuaWQgIT0gMCl7XG4gICAgICAgICAgICAvLyRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICRzY29wZS5jb250ZW50ID0gJ3ZpZXdzL3Rhc2tzLnRwbC5odG1sJztcbiAgICAgICAgICAgIFRhc2suZmV0Y2hUYXNrcyhcbiAgICAgICAgICAgICAgICAkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2plY3QuaWQsXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNpemVUYXNrLFxuICAgICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlYXJjaCxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50YXNrcyA9IGRhdGEudGFza3M7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zaXplVGFzayA+PSBkYXRhLnRvdGFsX2NvdW50ID8gJHNjb3BlLmlzQWxsVGFza3MgPSB0cnVlIDogJHNjb3BlLmlzQWxsVGFza3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50VGFzayA9IGRhdGEudG90YWxfY291bnQ7XG4gICAgICAgICAgICAgICAgICAgIC8vJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSAndmlld3Mvc2VsZWN0X3Byb2plY3QudHBsLmh0bWwnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYnVpbGRUb2dnbGVyKGNvbXBvbmVudElkKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtZFNpZGVuYXYoY29tcG9uZW50SWQpLnRvZ2dsZSgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5hcHAuc2VydmljZSgnQWNjb3VudCcsIGZ1bmN0aW9uKCRodHRwLCAkbG9nKSB7XG5cbiAgICB0aGlzLmNyZWF0ZU5ld1VzZXIgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3NpZ251cCdcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGNyZWF0ZU5ld1VzZXIgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHRoaXMuY2hlY2tTZXNzaW9uID0gZnVuY3Rpb24gKHNlc3Npb24gLGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9zZXNzaW9uJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb259LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGNoZWNrU2Vzc2lvbiBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdGhpcy5mZXRjaEFjY291bnQgPSBmdW5jdGlvbihzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vYWNjb3VudCcsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9ufSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuQWNjb3VudCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hBY2NvdW50IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuYXBwLnNlcnZpY2UoJ1Byb2plY3QnLCBmdW5jdGlvbigkaHR0cCwgJGxvZykge1xuXG4gICAgdGhpcy5mZXRjaFByb2plY3RzID0gZnVuY3Rpb24oc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Byb2plY3RzJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb259LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5wcm9qZWN0cyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hQcm9qZWN0cyBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5mZXRjaFByb2plY3QgPSBmdW5jdGlvbiAoc2Vzc2lvbiAsIHByb2plY3RfaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cy9wcm9qZWN0JyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb24sIHByb2plY3RfaWQ6IHByb2plY3RfaWR9LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGZldGNoUHJvamVjdCBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5jcmVhdGVQcm9qZWN0ID0gZnVuY3Rpb24oc2Vzc2lvbiwgdGl0bGUsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vcHJvamVjdHMvcHJvamVjdCcsXG4gICAgICAgICAgICBkYXRhOiB7c2Vzc2lvbjogc2Vzc2lvbiwgUHJvamVjdDogeyB0aXRsZTogdGl0bGUgfX0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLkFjY291bnQpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGNyZWF0ZVByb2plY3QgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMudXBkYXRlUHJvamVjdCA9IGZ1bmN0aW9uKHNlc3Npb24sIGlkLCB0aXRsZSwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cy9wcm9qZWN0JyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBQcm9qZWN0OiB7IGlkOiBpZCwgdGl0bGU6IHRpdGxlIH19LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5BY2NvdW50KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSB1cGRhdGVQcm9qZWN0IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmRlbGV0ZVByb2plY3QgPSBmdW5jdGlvbihzZXNzaW9uLCBpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Byb2plY3RzL3Byb2plY3QnLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbiwgcHJvamVjdF9pZDogaWR9LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5BY2NvdW50KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBkZWxldGVQcm9qZWN0IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuYXBwLnNlcnZpY2UoJ1Rhc2snLCBmdW5jdGlvbigkaHR0cCwgJGxvZywgJGZpbHRlcikge1xuXG4gICAgdGhpcy5mZXRjaFRhc2tzID0gZnVuY3Rpb24oc2Vzc2lvbiwgcHJvamVjdF9pZCwgcGFnaW5nX3NpemUsIHBhZ2luZ19vZmZzZXQsIGNvbmRpdGlvbl9rZXl3b3JkcywgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb24sIHByb2plY3RfaWQ6IHByb2plY3RfaWQsIHBhZ2luZ19zaXplOiBwYWdpbmdfc2l6ZSwgcGFnaW5nX29mZnNldDogcGFnaW5nX29mZnNldCwgY29uZGl0aW9uX2tleXdvcmRzOiBjb25kaXRpb25fa2V5d29yZHN9LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGRhdGU7XG4gICAgICAgICAgICB2YXIgck9iaiA9IHt9O1xuICAgICAgICAgICAgdmFyIHRvbW9ycm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIHRvbW9ycm93LnNldERhdGUodG9tb3Jyb3cuZ2V0RGF0ZSgpIC0gMSk7XG5cbiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEudGFza3MuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgICAgICAgICB2YXIgdGFza0RhdGUgPSBuZXcgRGF0ZShpdGVtLlRhc2suY3JlYXRlZF9hdCk7XG5cbiAgICAgICAgICAgICAgICBpdGVtLlRhc2suZGF0ZSA9ICRmaWx0ZXIoJ2RhdGUnKSh0YXNrRGF0ZSwgJ0VFRUUnKSArICcgKCcgKyAkZmlsdGVyKCdkYXRlJykodGFza0RhdGUsICdkZC5NTS55eXl5JykgKyAnKSc7XG5cbiAgICAgICAgICAgICAgICBpZigkZmlsdGVyKCdkYXRlJykobmV3IERhdGUoKSwgJ2RkLk1NLnl5eXknKSA9PSAkZmlsdGVyKCdkYXRlJykodGFza0RhdGUsICdkZC5NTS55eXl5JykpXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uVGFzay5kYXRlID0gXCJUb2RheVwiO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYoJGZpbHRlcignZGF0ZScpKHRvbW9ycm93LCAnZGQuTU0ueXl5eScpID09ICRmaWx0ZXIoJ2RhdGUnKSh0YXNrRGF0ZSwgJ2RkLk1NLnl5eXknKSlcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5UYXNrLmRhdGUgPSBcIlllc3RlcmRheVwiO1xuXG4gICAgICAgICAgICAgICAgaWYoaXRlbS5UYXNrLnRpdGxlICE9IG51bGwpe1xuICAgICAgICAgICAgICAgICAgICBpZihpdGVtLlRhc2suZGF0ZSA9PSBkYXRlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJPYmpbZGF0ZV0ucHVzaChpdGVtLlRhc2spO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGl0ZW0uVGFzay5kYXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgck9ialtkYXRlXSA9IFtpdGVtLlRhc2tdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgdGFza3M6IHJPYmosXG4gICAgICAgICAgICAgICAgdG90YWxfY291bnQ6IHJlc3BvbnNlLmRhdGEudG90YWxfY291bnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGZldGNoVGFza3MgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuZmV0Y2hUYXNrID0gZnVuY3Rpb24gKHNlc3Npb24gLCB0YXNrX2lkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9uLCB0YXNrX2lkOiB0YXNrX2lkfSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuVGFzayk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hQcm9qZWN0IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmNyZWF0ZVRhc2sgPSBmdW5jdGlvbihzZXNzaW9uLCBwcm9qZWN0X2lkLCB0aXRsZSwgZGVzY3JpcHRpb24sIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBkYXRhOiB7c2Vzc2lvbjogc2Vzc2lvbiwgUHJvamVjdDoge2lkOiBwcm9qZWN0X2lkfSwgVGFzazoge3RpdGxlOiB0aXRsZSwgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9ufX0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLlRhc2spO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGNyZWF0ZVRhc2sgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMudXBkYXRlVGFzayA9IGZ1bmN0aW9uKHNlc3Npb24sIGlkLCB0aXRsZSwgZGVzY3JpcHRpb24sIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBkYXRhOiB7c2Vzc2lvbjogc2Vzc2lvbiwgVGFzazoge2lkOiBpZCwgdGl0bGU6IHRpdGxlLCBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb259fSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIHVwZGF0ZVRhc2sgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVsZXRlVGFzayA9IGZ1bmN0aW9uKHNlc3Npb24sIGlkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9uLCB0YXNrX2lkOiBpZH0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBkZWxldGVUYXNrIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuY29tcGxpdGVUYXNrID0gZnVuY3Rpb24oc2Vzc2lvbiwgaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXG4gICAgICAgICAgICBkYXRhOiB7c2Vzc2lvbjogc2Vzc2lvbiwgVGFzazoge2lkOiBpZH19LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZGVsZXRlVGFzayBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxuYXBwLmRpcmVjdGl2ZSgncHJvamVjdHNMaXN0JywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiQUVcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvcHJvamVjdHMudHBsLmh0bWxcIlxuICAgIH1cbn0pO1xuYXBwLmRpcmVjdGl2ZSgnd2hlblNjcm9sbGVkJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbG0sIGF0dHIpIHtcbiAgICAgICAgdmFyIHJhdyA9IGVsbVswXTtcblxuICAgICAgICBlbG0uYmluZCgnc2Nyb2xsJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAocmF3LnNjcm9sbFRvcCArIHJhdy5vZmZzZXRIZWlnaHQgPj0gcmF3LnNjcm9sbEhlaWdodCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShhdHRyLndoZW5TY3JvbGxlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG59KTsiXX0=
