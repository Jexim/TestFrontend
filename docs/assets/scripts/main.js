!function(n,c){"use strict";function l(b,a,g){var d=g.baseHref(),k=b[0];return function(b,e,f){var g,h;f=f||{},h=f.expires,g=c.isDefined(f.path)?f.path:d,c.isUndefined(e)&&(h="Thu, 01 Jan 1970 00:00:00 GMT",e=""),c.isString(h)&&(h=new Date(h)),e=encodeURIComponent(b)+"="+encodeURIComponent(e),e=e+(g?";path="+g:"")+(f.domain?";domain="+f.domain:""),e+=h?";expires="+h.toUTCString():"",e+=f.secure?";secure":"",f=e.length+1,4096<f&&a.warn("Cookie '"+b+"' possibly not set or overflowed because it was too large ("+f+" > 4096 bytes)!"),k.cookie=e}}c.module("ngCookies",["ng"]).provider("$cookies",[function(){var b=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function(a,g){return{get:function(d){return a()[d]},getObject:function(d){return(d=this.get(d))?c.fromJson(d):d},getAll:function(){return a()},put:function(d,a,m){g(d,a,m?c.extend({},b,m):b)},putObject:function(d,b,a){this.put(d,c.toJson(b),a)},remove:function(a,k){g(a,void 0,k?c.extend({},b,k):b)}}}]}]),c.module("ngCookies").factory("$cookieStore",["$cookies",function(b){return{get:function(a){return b.getObject(a)},put:function(a,c){b.putObject(a,c)},remove:function(a){b.remove(a)}}}]),l.$inject=["$document","$log","$browser"],c.module("ngCookies").provider("$$cookieWriter",function(){this.$get=l})}(window,window.angular);var app=angular.module("TestFrontend",["ngMaterial","ngCookies"]);app.controller("MainCtrl",function($scope,$mdSidenav,$cookies,Account,Project,Task){function getAccountData(){Account.fetchAccount($cookies.get("userSessionKey"),function(data){$scope.account=data})}function getProjects(){Project.fetchProjects($cookies.get("userSessionKey"),function(data){$scope.projects=data})}function getTasks(){0!=$scope.project.id?($scope.loading=!0,$scope.content="views/tasks.tpl.html",Task.fetchTasks($cookies.get("userSessionKey"),$scope.project.id,$scope.sizeTask,0,$scope.search,function(data){$scope.tasks=data.tasks,$scope.sizeTask>=data.total_count?$scope.isAllTasks=!0:$scope.isAllTasks=!1,$scope.countTask=data.total_count,$scope.loading=!1})):$scope.content="views/select_project.tpl.html"}function buildToggler(componentId){return function(){$mdSidenav(componentId).toggle()}}$scope.loading=!0,$scope.stepTask=3,$scope.isAllTasks=!1,$scope.countTask=0,$scope.project={id:0},"string"!=typeof $cookies.get("userSessionKey")?($scope.loading=!0,Account.createNewUser(function(data){$cookies.put("userSessionKey",data.session),getAccountData(),getProjects(),$scope.loading=!1})):($scope.loading=!0,Account.checkSession($cookies.get("userSessionKey"),function(){$scope.loading=!1,getAccountData(),getProjects(),$scope.loading=!1})),$scope.$watch("project.id",function(){$scope.isAllTasks=!1,$scope.sizeTask=10,$scope.search=null,getTasks()}),$scope.$watch("search",function(){getTasks()}),$scope.$watch("tasks",function(){0==$scope.project.id||0!=$scope.countTask||$scope.search?0==$scope.countTask&&$scope.search&&($scope.content="views/tasks_not.tpl.html"):$scope.content="views/tasks_done.tpl.html"}),$scope.addProjectBar=function(){delete $scope.newProject,$scope.toggleRight(),$scope.rightBar="views/project_add.tpl.html"},$scope.showTaskBar=function(taskId){$scope.loading=!0,Task.fetchTask($cookies.get("userSessionKey"),taskId,function(data){$scope.task=data,$scope.toggleRight(),$scope.rightBar="views/task.tpl.html",$scope.loading=!1})},$scope.editProjectBar=function(){$scope.toggleRight(),$scope.project.newTitle=$scope.project.title,$scope.rightBar="views/project_edit.tpl.html"},$scope.addTaskBar=function(){delete $scope.newTask,$scope.toggleRight(),$scope.rightBar="views/task_add.tpl.html"},$scope.editTaskBar=function(){$scope.rightBar="views/task_edit.tpl.html"},$scope.addProject=function(){$scope.loading=!0,Project.createProject($cookies.get("userSessionKey"),$scope.newProject.title,function(){getProjects(),$scope.toggleRight(),$scope.loading=!1})},$scope.deleteProject=function(){$scope.loading=!0,Project.deleteProject($cookies.get("userSessionKey"),$scope.project.id,function(){getProjects(),$scope.loading=!1,$scope.content="views/select_project.tpl.html"})},$scope.editProject=function(){$scope.loading=!0,Project.updateProject($cookies.get("userSessionKey"),$scope.project.id,$scope.project.newTitle,function(){getProjects(),$scope.toggleRight(),$scope.project.title=$scope.project.newTitle,$scope.loading=!1})},$scope.addTask=function(){$scope.loading=!0,Task.createTask($cookies.get("userSessionKey"),$scope.project.id,$scope.newTask.title,$scope.newTask.description,function(){getProjects(),getTasks(),$scope.toggleRight(),$scope.loading=!1})},$scope.editTask=function(){$scope.loading=!0,Task.updateTask($cookies.get("userSessionKey"),$scope.task.id,$scope.task.title,$scope.task.description,function(){getTasks(),$scope.rightBar="views/task.tpl.html",$scope.loading=!1})},$scope.deleteTask=function(){$scope.loading=!0,Task.deleteTask($cookies.get("userSessionKey"),$scope.task.id,function(){getProjects(),getTasks(),$scope.toggleRight(),$scope.loading=!1})},$scope.compliteTask=function(id){$scope.loading=!0,Task.compliteTask($cookies.get("userSessionKey"),id,function(){getProjects(),getTasks(),$scope.loading=!1})},$scope.loadMoreTasks=function(){$scope.isAllTasks||($scope.sizeTask=$scope.sizeTask+$scope.stepTask,$scope.sizeTask>$scope.countTask&&($scope.sizeTask=$scope.countTask),getTasks())},$scope.openMenu=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},$scope.toggleRight=buildToggler("right")}),app.service("Account",function($http,$log){this.createNewUser=function(callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/signup"}).then(function(response){callback(response.data)},function(){$log.error("API createNewUser error")})},this.checkSession=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/session",params:{session:session}}).then(function(response){callback(response)},function(){$log.error("API checkSession error")})},this.fetchAccount=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/account",params:{session:session}}).then(function(response){callback(response.data.Account)},function(){$log.error("API fetchAccount error")})}}),app.service("Project",function($http,$log){this.fetchProjects=function(session,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects",params:{session:session}}).then(function(response){callback(response.data.projects)},function(){$log.error("API fetchProjects error")})},this.fetchProject=function(session,project_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:project_id}}).then(function(response){callback(response)},function(){$log.error("API fetchProject error")})},this.createProject=function(session,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API createProject error")})},this.updateProject=function(session,id,title,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:session,Project:{id:id,title:title}}}).then(function(response){callback(response.data.Account)},function(){$log.error("API updateProject error")})},this.deleteProject=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/projects/project",params:{session:session,project_id:id}}).then(function(response){callback(response.data.Account)},function(){$log.error("API deleteProject error")})}}),app.service("Task",function($http,$log,$filter){this.fetchTasks=function(session,project_id,paging_size,paging_offset,condition_keywords,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks",params:{session:session,project_id:project_id,paging_size:paging_size,paging_offset:paging_offset,condition_keywords:condition_keywords}}).then(function(response){var date,rObj={},tomorrow=new Date;tomorrow.setDate(tomorrow.getDate()-1),response.data.tasks.forEach(function(item){var taskDate=new Date(item.Task.created_at);item.Task.date=$filter("date")(taskDate,"EEEE")+" ("+$filter("date")(taskDate,"dd.MM.yyyy")+")",$filter("date")(new Date,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")?item.Task.date="Today":$filter("date")(tomorrow,"dd.MM.yyyy")==$filter("date")(taskDate,"dd.MM.yyyy")&&(item.Task.date="Yesterday"),null!=item.Task.title&&(item.Task.date==date?rObj[date].push(item.Task):(date=item.Task.date,rObj[date]=[item.Task]))}),callback({tasks:rObj,total_count:response.data.total_count})},function(){$log.error("API fetchTasks error")})},this.fetchTask=function(session,task_id,callback){$http({method:"GET",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:task_id}}).then(function(response){callback(response.data.Task)},function(){$log.error("API fetchProject error")})},this.createTask=function(session,project_id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Project:{id:project_id},Task:{title:title,description:description}}}).then(function(response){callback(response.data.Task)},function(){$log.error("API createTask error")})},this.updateTask=function(session,id,title,description,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id,title:title,description:description}}}).then(function(response){callback(response.data)},function(){$log.error("API updateTask error")})},this.deleteTask=function(session,id,callback){$http({method:"DELETE",url:"https://api-test-task.decodeapps.io/tasks/task",params:{session:session,task_id:id}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})},this.compliteTask=function(session,id,callback){$http({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:session,Task:{id:id}}}).then(function(response){callback(response.data)},function(){$log.error("API deleteTask error")})}}),app.directive("projectsList",function(){return{restrict:"AE",templateUrl:"views/projects.tpl.html"}}),app.directive("whenScrolled",function(){return function(scope,elm,attr){var raw=elm[0];elm.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight&&scope.$apply(attr.whenScrolled)})}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibiIsImMiLCJsIiwiYiIsImEiLCJnIiwiZCIsImJhc2VIcmVmIiwiayIsImUiLCJmIiwiaCIsImV4cGlyZXMiLCJpc0RlZmluZWQiLCJwYXRoIiwiaXNVbmRlZmluZWQiLCJpc1N0cmluZyIsIkRhdGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJkb21haW4iLCJ0b1VUQ1N0cmluZyIsInNlY3VyZSIsImxlbmd0aCIsIndhcm4iLCJjb29raWUiLCJtb2R1bGUiLCJwcm92aWRlciIsInRoaXMiLCJkZWZhdWx0cyIsIiRnZXQiLCJnZXQiLCJnZXRPYmplY3QiLCJmcm9tSnNvbiIsImdldEFsbCIsInB1dCIsIm0iLCJleHRlbmQiLCJwdXRPYmplY3QiLCJ0b0pzb24iLCJyZW1vdmUiLCJmYWN0b3J5IiwiJGluamVjdCIsIndpbmRvdyIsImFuZ3VsYXIiLCJhcHAiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJG1kU2lkZW5hdiIsIiRjb29raWVzIiwiQWNjb3VudCIsIlByb2plY3QiLCJUYXNrIiwiZ2V0QWNjb3VudERhdGEiLCJmZXRjaEFjY291bnQiLCJkYXRhIiwiYWNjb3VudCIsImdldFByb2plY3RzIiwiZmV0Y2hQcm9qZWN0cyIsInByb2plY3RzIiwiZ2V0VGFza3MiLCJwcm9qZWN0IiwiaWQiLCJsb2FkaW5nIiwiY29udGVudCIsImZldGNoVGFza3MiLCJzaXplVGFzayIsInNlYXJjaCIsInRhc2tzIiwidG90YWxfY291bnQiLCJpc0FsbFRhc2tzIiwiY291bnRUYXNrIiwiYnVpbGRUb2dnbGVyIiwiY29tcG9uZW50SWQiLCJ0b2dnbGUiLCJzdGVwVGFzayIsImNyZWF0ZU5ld1VzZXIiLCJzZXNzaW9uIiwiY2hlY2tTZXNzaW9uIiwiJHdhdGNoIiwiYWRkUHJvamVjdEJhciIsIm5ld1Byb2plY3QiLCJ0b2dnbGVSaWdodCIsInJpZ2h0QmFyIiwic2hvd1Rhc2tCYXIiLCJ0YXNrSWQiLCJmZXRjaFRhc2siLCJ0YXNrIiwiZWRpdFByb2plY3RCYXIiLCJuZXdUaXRsZSIsInRpdGxlIiwiYWRkVGFza0JhciIsIm5ld1Rhc2siLCJlZGl0VGFza0JhciIsImFkZFByb2plY3QiLCJjcmVhdGVQcm9qZWN0IiwiZGVsZXRlUHJvamVjdCIsImVkaXRQcm9qZWN0IiwidXBkYXRlUHJvamVjdCIsImFkZFRhc2siLCJjcmVhdGVUYXNrIiwiZGVzY3JpcHRpb24iLCJlZGl0VGFzayIsInVwZGF0ZVRhc2siLCJkZWxldGVUYXNrIiwiY29tcGxpdGVUYXNrIiwibG9hZE1vcmVUYXNrcyIsIm9wZW5NZW51IiwiJG1kT3Blbk1lbnUiLCJldiIsIm9yaWdpbmF0b3JFdiIsInNlcnZpY2UiLCIkaHR0cCIsIiRsb2ciLCJjYWxsYmFjayIsIm1ldGhvZCIsInVybCIsInRoZW4iLCJyZXNwb25zZSIsImVycm9yIiwicGFyYW1zIiwiZmV0Y2hQcm9qZWN0IiwicHJvamVjdF9pZCIsIiRmaWx0ZXIiLCJwYWdpbmdfc2l6ZSIsInBhZ2luZ19vZmZzZXQiLCJjb25kaXRpb25fa2V5d29yZHMiLCJkYXRlIiwick9iaiIsInRvbW9ycm93Iiwic2V0RGF0ZSIsImdldERhdGUiLCJmb3JFYWNoIiwiaXRlbSIsInRhc2tEYXRlIiwiY3JlYXRlZF9hdCIsInB1c2giLCJ0YXNrX2lkIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZVVybCIsInNjb3BlIiwiZWxtIiwiYXR0ciIsInJhdyIsImJpbmQiLCJzY3JvbGxUb3AiLCJvZmZzZXRIZWlnaHQiLCJzY3JvbGxIZWlnaHQiLCIkYXBwbHkiLCJ3aGVuU2Nyb2xsZWQiXSwibWFwcGluZ3MiOiJDQVNBLFNBQVVBLEVBQUVDLEdBQUcsWUFBYSxTQUFTQyxHQUFFQyxFQUFFQyxFQUFFQyxHQUFHLEdBQUlDLEdBQUVELEVBQUVFLFdBQVdDLEVBQUVMLEVBQUUsRUFBRyxPQUFPLFVBQVNBLEVBQUVNLEVBQUVDLEdBQUcsR0FBSUwsR0FBRU0sQ0FBRUQsR0FBRUEsTUFBTUMsRUFBRUQsRUFBRUUsUUFBUVAsRUFB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bkIzRixLQUFLNkUsYUFBZSxTQUFTNUIsUUFBU2YsR0FBSW9ELFVBQ3RDRixPQUNJRyxPQUFRLE9BQ1JDLElBQUssaURBQ0w3RCxNQUFPc0IsUUFBU0EsUUFBU3pCLE1BQU9VLEdBQUlBLE9BQ3JDdUQsS0FBSyxTQUF5QkMsVUFDN0JKLFNBQVNJLFNBQVMvRCxPQUNuQixXQUNDMEQsS0FBS00sTUFBTSw2QkFLdkIxRSxJQUFJNkYsVUFBVSxlQUFnQixXQUMxQixPQUNJQyxTQUFVLEtBQ1ZDLFlBQWEsNkJBR3JCL0YsSUFBSTZGLFVBQVUsZUFBZ0IsV0FDMUIsTUFBTyxVQUFTRyxNQUFPQyxJQUFLQyxNQUN4QixHQUFJQyxLQUFNRixJQUFJLEVBRWRBLEtBQUlHLEtBQUssU0FBVSxXQUNYRCxJQUFJRSxVQUFZRixJQUFJRyxjQUFnQkgsSUFBSUksY0FDeENQLE1BQU1RLE9BQU9OLEtBQUtPIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgSmV4aW0gb24gMTkuMTAuMTYuXG4gKi9cblxuLypcbiBBbmd1bGFySlMgdjEuNS44XG4gKGMpIDIwMTAtMjAxNiBHb29nbGUsIEluYy4gaHR0cDovL2FuZ3VsYXJqcy5vcmdcbiBMaWNlbnNlOiBNSVRcbiovXG4oZnVuY3Rpb24obixjKXsndXNlIHN0cmljdCc7ZnVuY3Rpb24gbChiLGEsZyl7dmFyIGQ9Zy5iYXNlSHJlZigpLGs9YlswXTtyZXR1cm4gZnVuY3Rpb24oYixlLGYpe3ZhciBnLGg7Zj1mfHx7fTtoPWYuZXhwaXJlcztnPWMuaXNEZWZpbmVkKGYucGF0aCk/Zi5wYXRoOmQ7Yy5pc1VuZGVmaW5lZChlKSYmKGg9XCJUaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVFwiLGU9XCJcIik7Yy5pc1N0cmluZyhoKSYmKGg9bmV3IERhdGUoaCkpO2U9ZW5jb2RlVVJJQ29tcG9uZW50KGIpK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudChlKTtlPWUrKGc/XCI7cGF0aD1cIitnOlwiXCIpKyhmLmRvbWFpbj9cIjtkb21haW49XCIrZi5kb21haW46XCJcIik7ZSs9aD9cIjtleHBpcmVzPVwiK2gudG9VVENTdHJpbmcoKTpcIlwiO2UrPWYuc2VjdXJlP1wiO3NlY3VyZVwiOlwiXCI7Zj1lLmxlbmd0aCsxOzQwOTY8ZiYmYS53YXJuKFwiQ29va2llICdcIitiK1wiJyBwb3NzaWJseSBub3Qgc2V0IG9yIG92ZXJmbG93ZWQgYmVjYXVzZSBpdCB3YXMgdG9vIGxhcmdlIChcIitcbmYrXCIgPiA0MDk2IGJ5dGVzKSFcIik7ay5jb29raWU9ZX19Yy5tb2R1bGUoXCJuZ0Nvb2tpZXNcIixbXCJuZ1wiXSkucHJvdmlkZXIoXCIkY29va2llc1wiLFtmdW5jdGlvbigpe3ZhciBiPXRoaXMuZGVmYXVsdHM9e307dGhpcy4kZ2V0PVtcIiQkY29va2llUmVhZGVyXCIsXCIkJGNvb2tpZVdyaXRlclwiLGZ1bmN0aW9uKGEsZyl7cmV0dXJue2dldDpmdW5jdGlvbihkKXtyZXR1cm4gYSgpW2RdfSxnZXRPYmplY3Q6ZnVuY3Rpb24oZCl7cmV0dXJuKGQ9dGhpcy5nZXQoZCkpP2MuZnJvbUpzb24oZCk6ZH0sZ2V0QWxsOmZ1bmN0aW9uKCl7cmV0dXJuIGEoKX0scHV0OmZ1bmN0aW9uKGQsYSxtKXtnKGQsYSxtP2MuZXh0ZW5kKHt9LGIsbSk6Yil9LHB1dE9iamVjdDpmdW5jdGlvbihkLGIsYSl7dGhpcy5wdXQoZCxjLnRvSnNvbihiKSxhKX0scmVtb3ZlOmZ1bmN0aW9uKGEsayl7ZyhhLHZvaWQgMCxrP2MuZXh0ZW5kKHt9LGIsayk6Yil9fX1dfV0pO2MubW9kdWxlKFwibmdDb29raWVzXCIpLmZhY3RvcnkoXCIkY29va2llU3RvcmVcIixcbltcIiRjb29raWVzXCIsZnVuY3Rpb24oYil7cmV0dXJue2dldDpmdW5jdGlvbihhKXtyZXR1cm4gYi5nZXRPYmplY3QoYSl9LHB1dDpmdW5jdGlvbihhLGMpe2IucHV0T2JqZWN0KGEsYyl9LHJlbW92ZTpmdW5jdGlvbihhKXtiLnJlbW92ZShhKX19fV0pO2wuJGluamVjdD1bXCIkZG9jdW1lbnRcIixcIiRsb2dcIixcIiRicm93c2VyXCJdO2MubW9kdWxlKFwibmdDb29raWVzXCIpLnByb3ZpZGVyKFwiJCRjb29raWVXcml0ZXJcIixmdW5jdGlvbigpe3RoaXMuJGdldD1sfSl9KSh3aW5kb3csd2luZG93LmFuZ3VsYXIpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YW5ndWxhci1jb29raWVzLm1pbi5qcy5tYXBcblxuLyoqXG4gKiBDcmVhdGVkIGJ5IEpleGltIG9uIDE5LjEwLjE2LlxuICovXG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnVGVzdEZyb250ZW5kJywgWyduZ01hdGVyaWFsJywgJ25nQ29va2llcyddKTtcblxuYXBwLmNvbnRyb2xsZXIoJ01haW5DdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgJG1kU2lkZW5hdiwgJGNvb2tpZXMsIEFjY291bnQsIFByb2plY3QsIFRhc2spe1xuXG4gICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICRzY29wZS5zdGVwVGFzayA9IDM7XG4gICAgJHNjb3BlLmlzQWxsVGFza3MgPSBmYWxzZTtcbiAgICAkc2NvcGUuY291bnRUYXNrID0gMDtcbiAgICAkc2NvcGUucHJvamVjdCA9IHsgaWQ6IDAgfTtcblxuICAgIGlmKHR5cGVvZiAkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JykgIT0gJ3N0cmluZycpe1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIEFjY291bnQuY3JlYXRlTmV3VXNlcihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgndXNlclNlc3Npb25LZXknLCBkYXRhLnNlc3Npb24pO1xuICAgICAgICAgICAgZ2V0QWNjb3VudERhdGEoKTtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIEFjY291bnQuY2hlY2tTZXNzaW9uKCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgZ2V0QWNjb3VudERhdGEoKTtcbiAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAkc2NvcGUuJHdhdGNoKCdwcm9qZWN0LmlkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5pc0FsbFRhc2tzID0gZmFsc2U7XG4gICAgICAgICRzY29wZS5zaXplVGFzayA9IDEwO1xuICAgICAgICAkc2NvcGUuc2VhcmNoID0gbnVsbDtcbiAgICAgICAgZ2V0VGFza3MoKTtcbiAgICB9KTtcblxuICAgICRzY29wZS4kd2F0Y2goJ3NlYXJjaCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICBnZXRUYXNrcygpO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLiR3YXRjaCgndGFza3MnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmKCRzY29wZS5wcm9qZWN0LmlkICE9IDAgJiYgJHNjb3BlLmNvdW50VGFzayA9PSAwICYmICEkc2NvcGUuc2VhcmNoKXtcbiAgICAgICAgICAgICRzY29wZS5jb250ZW50ID0gJ3ZpZXdzL3Rhc2tzX2RvbmUudHBsLmh0bWwnO1xuICAgICAgICB9IGVsc2UgaWYoJHNjb3BlLmNvdW50VGFzayA9PSAwICYmICRzY29wZS5zZWFyY2gpIHtcbiAgICAgICAgICAgICRzY29wZS5jb250ZW50ID0gJ3ZpZXdzL3Rhc2tzX25vdC50cGwuaHRtbCc7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICRzY29wZS5hZGRQcm9qZWN0QmFyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGRlbGV0ZSAkc2NvcGUubmV3UHJvamVjdDtcbiAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy9wcm9qZWN0X2FkZC50cGwuaHRtbCc7XG4gICAgfTtcblxuICAgICRzY29wZS5zaG93VGFza0JhciA9IGZ1bmN0aW9uKHRhc2tJZCkge1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFRhc2suZmV0Y2hUYXNrKCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgdGFza0lkLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICRzY29wZS50YXNrID0gZGF0YTtcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAgICAgJHNjb3BlLnJpZ2h0QmFyID0gJ3ZpZXdzL3Rhc2sudHBsLmh0bWwnO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5lZGl0UHJvamVjdEJhciAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnRvZ2dsZVJpZ2h0KCk7XG4gICAgICAgICRzY29wZS5wcm9qZWN0Lm5ld1RpdGxlID0gJHNjb3BlLnByb2plY3QudGl0bGU7XG4gICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy9wcm9qZWN0X2VkaXQudHBsLmh0bWwnO1xuICAgIH07XG5cblxuICAgICRzY29wZS5hZGRUYXNrQmFyICA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkZWxldGUgJHNjb3BlLm5ld1Rhc2s7XG4gICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAkc2NvcGUucmlnaHRCYXIgPSAndmlld3MvdGFza19hZGQudHBsLmh0bWwnO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZWRpdFRhc2tCYXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnJpZ2h0QmFyID0gJ3ZpZXdzL3Rhc2tfZWRpdC50cGwuaHRtbCc7XG4gICAgfTtcblxuICAgICRzY29wZS5hZGRQcm9qZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgUHJvamVjdC5jcmVhdGVQcm9qZWN0KCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgJHNjb3BlLm5ld1Byb2plY3QudGl0bGUsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5kZWxldGVQcm9qZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgUHJvamVjdC5kZWxldGVQcm9qZWN0KCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgJHNjb3BlLnByb2plY3QuaWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy9zZWxlY3RfcHJvamVjdC50cGwuaHRtbCc7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZWRpdFByb2plY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBQcm9qZWN0LnVwZGF0ZVByb2plY3QoJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCAkc2NvcGUucHJvamVjdC5pZCwgJHNjb3BlLnByb2plY3QubmV3VGl0bGUsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAgICAgJHNjb3BlLnByb2plY3QudGl0bGUgPSAkc2NvcGUucHJvamVjdC5uZXdUaXRsZTtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cblxuICAgICRzY29wZS5hZGRUYXNrICA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFRhc2suY3JlYXRlVGFzayhcbiAgICAgICAgICAgICRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSxcbiAgICAgICAgICAgICRzY29wZS5wcm9qZWN0LmlkLFxuICAgICAgICAgICAgJHNjb3BlLm5ld1Rhc2sudGl0bGUsXG4gICAgICAgICAgICAkc2NvcGUubmV3VGFzay5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGdldFByb2plY3RzKCk7XG4gICAgICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUudG9nZ2xlUmlnaHQoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZWRpdFRhc2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBUYXNrLnVwZGF0ZVRhc2soXG4gICAgICAgICAgICAkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksXG4gICAgICAgICAgICAkc2NvcGUudGFzay5pZCxcbiAgICAgICAgICAgICRzY29wZS50YXNrLnRpdGxlLFxuICAgICAgICAgICAgJHNjb3BlLnRhc2suZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBnZXRUYXNrcygpO1xuICAgICAgICAgICAgICAgICRzY29wZS5yaWdodEJhciA9ICd2aWV3cy90YXNrLnRwbC5odG1sJztcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZGVsZXRlVGFzayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFRhc2suZGVsZXRlVGFzaygkY29va2llcy5nZXQoJ3VzZXJTZXNzaW9uS2V5JyksICRzY29wZS50YXNrLmlkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnZXRQcm9qZWN0cygpO1xuICAgICAgICAgICAgZ2V0VGFza3MoKTtcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVSaWdodCgpO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5jb21wbGl0ZVRhc2sgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgIFRhc2suY29tcGxpdGVUYXNrKCRjb29raWVzLmdldCgndXNlclNlc3Npb25LZXknKSwgaWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgIGdldFRhc2tzKCk7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmxvYWRNb3JlVGFza3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmKCEkc2NvcGUuaXNBbGxUYXNrcyl7XG4gICAgICAgICAgICAkc2NvcGUuc2l6ZVRhc2sgPSAkc2NvcGUuc2l6ZVRhc2sgKyAkc2NvcGUuc3RlcFRhc2s7XG4gICAgICAgICAgICBpZigkc2NvcGUuc2l6ZVRhc2sgPiAkc2NvcGUuY291bnRUYXNrKVxuICAgICAgICAgICAgICAgICRzY29wZS5zaXplVGFzayA9ICRzY29wZS5jb3VudFRhc2s7XG4gICAgICAgICAgICBnZXRUYXNrcygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5vcGVuTWVudSA9IGZ1bmN0aW9uKCRtZE9wZW5NZW51LCBldikge1xuICAgICAgICBvcmlnaW5hdG9yRXYgPSBldjtcbiAgICAgICAgJG1kT3Blbk1lbnUoZXYpO1xuICAgIH07XG5cbiAgICAkc2NvcGUudG9nZ2xlUmlnaHQgPSBidWlsZFRvZ2dsZXIoJ3JpZ2h0Jyk7XG5cbiAgICBmdW5jdGlvbiBnZXRBY2NvdW50RGF0YSgpIHtcbiAgICAgICAgQWNjb3VudC5mZXRjaEFjY291bnQoJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAkc2NvcGUuYWNjb3VudCA9IGRhdGE7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFByb2plY3RzKCkge1xuICAgICAgICBQcm9qZWN0LmZldGNoUHJvamVjdHMoJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAkc2NvcGUucHJvamVjdHMgPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRUYXNrcygpIHtcbiAgICAgICAgaWYoJHNjb3BlLnByb2plY3QuaWQgIT0gMCl7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy90YXNrcy50cGwuaHRtbCc7XG4gICAgICAgICAgICBUYXNrLmZldGNoVGFza3MoXG4gICAgICAgICAgICAgICAgJGNvb2tpZXMuZ2V0KCd1c2VyU2Vzc2lvbktleScpLFxuICAgICAgICAgICAgICAgICRzY29wZS5wcm9qZWN0LmlkLFxuICAgICAgICAgICAgICAgICRzY29wZS5zaXplVGFzayxcbiAgICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICAgICRzY29wZS5zZWFyY2gsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGFza3MgPSBkYXRhLnRhc2tzO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZVRhc2sgPj0gZGF0YS50b3RhbF9jb3VudCA/ICRzY29wZS5pc0FsbFRhc2tzID0gdHJ1ZSA6ICRzY29wZS5pc0FsbFRhc2tzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudFRhc2sgPSBkYXRhLnRvdGFsX2NvdW50O1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9ICd2aWV3cy9zZWxlY3RfcHJvamVjdC50cGwuaHRtbCc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBidWlsZFRvZ2dsZXIoY29tcG9uZW50SWQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1kU2lkZW5hdihjb21wb25lbnRJZCkudG9nZ2xlKCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbmFwcC5zZXJ2aWNlKCdBY2NvdW50JywgZnVuY3Rpb24oJGh0dHAsICRsb2cpIHtcblxuICAgIHRoaXMuY3JlYXRlTmV3VXNlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vc2lnbnVwJ1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgY3JlYXRlTmV3VXNlciBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdGhpcy5jaGVja1Nlc3Npb24gPSBmdW5jdGlvbiAoc2Vzc2lvbiAsY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Nlc3Npb24nLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbn0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgY2hlY2tTZXNzaW9uIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB0aGlzLmZldGNoQWNjb3VudCA9IGZ1bmN0aW9uKHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9hY2NvdW50JyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb259LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5BY2NvdW50KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBmZXRjaEFjY291bnQgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5hcHAuc2VydmljZSgnUHJvamVjdCcsIGZ1bmN0aW9uKCRodHRwLCAkbG9nKSB7XG5cbiAgICB0aGlzLmZldGNoUHJvamVjdHMgPSBmdW5jdGlvbihzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vcHJvamVjdHMnLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbn0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLnByb2plY3RzKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBmZXRjaFByb2plY3RzIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmZldGNoUHJvamVjdCA9IGZ1bmN0aW9uIChzZXNzaW9uICwgcHJvamVjdF9pZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Byb2plY3RzL3Byb2plY3QnLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbiwgcHJvamVjdF9pZDogcHJvamVjdF9pZH0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hQcm9qZWN0IGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmNyZWF0ZVByb2plY3QgPSBmdW5jdGlvbihzZXNzaW9uLCB0aXRsZSwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cy9wcm9qZWN0JyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBQcm9qZWN0OiB7IHRpdGxlOiB0aXRsZSB9fSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuQWNjb3VudCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgY3JlYXRlUHJvamVjdCBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy51cGRhdGVQcm9qZWN0ID0gZnVuY3Rpb24oc2Vzc2lvbiwgaWQsIHRpdGxlLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Byb2plY3RzL3Byb2plY3QnLFxuICAgICAgICAgICAgZGF0YToge3Nlc3Npb246IHNlc3Npb24sIFByb2plY3Q6IHsgaWQ6IGlkLCB0aXRsZTogdGl0bGUgfX0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLkFjY291bnQpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIHVwZGF0ZVByb2plY3QgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVsZXRlUHJvamVjdCA9IGZ1bmN0aW9uKHNlc3Npb24sIGlkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vcHJvamVjdHMvcHJvamVjdCcsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZXNzaW9uOiBzZXNzaW9uLCBwcm9qZWN0X2lkOiBpZH0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhLkFjY291bnQpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGRlbGV0ZVByb2plY3QgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5hcHAuc2VydmljZSgnVGFzaycsIGZ1bmN0aW9uKCRodHRwLCAkbG9nLCAkZmlsdGVyKSB7XG5cbiAgICB0aGlzLmZldGNoVGFza3MgPSBmdW5jdGlvbihzZXNzaW9uLCBwcm9qZWN0X2lkLCBwYWdpbmdfc2l6ZSwgcGFnaW5nX29mZnNldCwgY29uZGl0aW9uX2tleXdvcmRzLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MnLFxuICAgICAgICAgICAgcGFyYW1zOiB7c2Vzc2lvbjogc2Vzc2lvbiwgcHJvamVjdF9pZDogcHJvamVjdF9pZCwgcGFnaW5nX3NpemU6IHBhZ2luZ19zaXplLCBwYWdpbmdfb2Zmc2V0OiBwYWdpbmdfb2Zmc2V0LCBjb25kaXRpb25fa2V5d29yZHM6IGNvbmRpdGlvbl9rZXl3b3Jkc30sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgZGF0ZTtcbiAgICAgICAgICAgIHZhciByT2JqID0ge307XG4gICAgICAgICAgICB2YXIgdG9tb3Jyb3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgdG9tb3Jyb3cuc2V0RGF0ZSh0b21vcnJvdy5nZXREYXRlKCkgLSAxKTtcblxuICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS50YXNrcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgICAgIHZhciB0YXNrRGF0ZSA9IG5ldyBEYXRlKGl0ZW0uVGFzay5jcmVhdGVkX2F0KTtcblxuICAgICAgICAgICAgICAgIGl0ZW0uVGFzay5kYXRlID0gJGZpbHRlcignZGF0ZScpKHRhc2tEYXRlLCAnRUVFRScpICsgJyAoJyArICRmaWx0ZXIoJ2RhdGUnKSh0YXNrRGF0ZSwgJ2RkLk1NLnl5eXknKSArICcpJztcblxuICAgICAgICAgICAgICAgIGlmKCRmaWx0ZXIoJ2RhdGUnKShuZXcgRGF0ZSgpLCAnZGQuTU0ueXl5eScpID09ICRmaWx0ZXIoJ2RhdGUnKSh0YXNrRGF0ZSwgJ2RkLk1NLnl5eXknKSlcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5UYXNrLmRhdGUgPSBcIlRvZGF5XCI7XG4gICAgICAgICAgICAgICAgZWxzZSBpZigkZmlsdGVyKCdkYXRlJykodG9tb3Jyb3csICdkZC5NTS55eXl5JykgPT0gJGZpbHRlcignZGF0ZScpKHRhc2tEYXRlLCAnZGQuTU0ueXl5eScpKVxuICAgICAgICAgICAgICAgICAgICBpdGVtLlRhc2suZGF0ZSA9IFwiWWVzdGVyZGF5XCI7XG5cbiAgICAgICAgICAgICAgICBpZihpdGVtLlRhc2sudGl0bGUgIT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0uVGFzay5kYXRlID09IGRhdGUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgck9ialtkYXRlXS5wdXNoKGl0ZW0uVGFzayk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gaXRlbS5UYXNrLmRhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICByT2JqW2RhdGVdID0gW2l0ZW0uVGFza107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICB0YXNrczogck9iaixcbiAgICAgICAgICAgICAgICB0b3RhbF9jb3VudDogcmVzcG9uc2UuZGF0YS50b3RhbF9jb3VudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgZmV0Y2hUYXNrcyBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5mZXRjaFRhc2sgPSBmdW5jdGlvbiAoc2Vzc2lvbiAsIHRhc2tfaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb24sIHRhc2tfaWQ6IHRhc2tfaWR9LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YS5UYXNrKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBmZXRjaFByb2plY3QgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuY3JlYXRlVGFzayA9IGZ1bmN0aW9uKHNlc3Npb24sIHByb2plY3RfaWQsIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBQcm9qZWN0OiB7aWQ6IHByb2plY3RfaWR9LCBUYXNrOiB7dGl0bGU6IHRpdGxlLCBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb259fSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEuVGFzayk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgY3JlYXRlVGFzayBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy51cGRhdGVUYXNrID0gZnVuY3Rpb24oc2Vzc2lvbiwgaWQsIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBUYXNrOiB7aWQ6IGlkLCB0aXRsZTogdGl0bGUsIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbn19LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdBUEkgdXBkYXRlVGFzayBlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZWxldGVUYXNrID0gZnVuY3Rpb24oc2Vzc2lvbiwgaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIHBhcmFtczoge3Nlc3Npb246IHNlc3Npb24sIHRhc2tfaWQ6IGlkfSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKCkge1xuICAgICAgICAgICAgJGxvZy5lcnJvcignQVBJIGRlbGV0ZVRhc2sgZXJyb3InKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5jb21wbGl0ZVRhc2sgPSBmdW5jdGlvbihzZXNzaW9uLCBpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrJyxcbiAgICAgICAgICAgIGRhdGE6IHtzZXNzaW9uOiBzZXNzaW9uLCBUYXNrOiB7aWQ6IGlkfX0sXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FQSSBkZWxldGVUYXNrIGVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuXG5hcHAuZGlyZWN0aXZlKCdwcm9qZWN0c0xpc3QnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogXCJBRVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9wcm9qZWN0cy50cGwuaHRtbFwiXG4gICAgfVxufSk7XG5hcHAuZGlyZWN0aXZlKCd3aGVuU2Nyb2xsZWQnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsbSwgYXR0cikge1xuICAgICAgICB2YXIgcmF3ID0gZWxtWzBdO1xuXG4gICAgICAgIGVsbS5iaW5kKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChyYXcuc2Nyb2xsVG9wICsgcmF3Lm9mZnNldEhlaWdodCA+PSByYXcuc2Nyb2xsSGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGF0dHIud2hlblNjcm9sbGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbn0pOyJdfQ==
